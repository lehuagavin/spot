<!-- ç¡®è®¤è®¢å•é¡µé¢ -->
<view class="page-container">
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
  </view>
  
  <block wx:elif="{{course}}">
    <!-- è¯¾ç¨‹ä¿¡æ¯ -->
    <view class="course-card">
      <view class="course-header">
        <text class="course-name">{{course.name}}</text>
        <view class="status-tag">æŠ¥åä¸­</view>
      </view>
      <view class="course-info">
        <text>å½“å‰å‘¨æœŸ ç¬¬{{course.current_week || 1}}å‘¨ï¼ˆæ€»å‘¨æœŸ{{course.total_weeks || 10}}å‘¨ï¼‰</text>
      </view>
      <view class="course-info highlight">
        <text>å‰©ä½™{{course.remaining_slots || 4}}ä¸ªåé¢</text>
      </view>
      <view class="course-info">
        <text class="icon">ğŸ•</text>
        <text>{{course.schedule}}</text>
      </view>
      <view class="course-info">
        <text class="icon">ğŸ“</text>
        <text>{{course.community_name}}</text>
      </view>
    </view>
    
    <!-- é€‰æ‹©å­¦å‘˜ -->
    <view class="student-section">
      <view class="section-header" bindtap="onSelectStudent">
        <text class="section-title">é€‰æ‹©å­¦å‘˜</text>
        <text class="section-action">{{selectedStudents.length > 0 ? 'ä¿®æ”¹' : 'è¯·é€‰æ‹©'}} â€º</text>
      </view>
      
      <view class="student-list" wx:if="{{selectedStudents.length > 0}}">
        <view class="student-item" wx:for="{{selectedStudents}}" wx:key="id">
          <view class="student-info">
            <text class="student-name">{{item.name}}</text>
            <view class="new-tag" wx:if="{{item.is_new}}">æ–°äººä»·</view>
          </view>
          <view class="student-price">
            <text class="price-original" wx:if="{{item.is_new}}">Â¥{{course.price}}</text>
            <text class="price-current">Â¥{{item.is_new ? '9.9' : course.price}}</text>
          </view>
          <view class="student-remove" catchtap="onRemoveStudent" data-id="{{item.id}}">âœ•</view>
        </view>
      </view>
    </view>
    
    <!-- è´¹ç”¨æ˜ç»† -->
    <view class="price-section" wx:if="{{selectedStudents.length > 0}}">
      <view class="price-row">
        <text class="price-label">è¯¾ç¨‹å•ä»·</text>
        <text class="price-value">Â¥{{course.price}}/ä½</text>
      </view>
      <view class="price-row" wx:if="{{discountPrice > 0}}">
        <text class="price-label">å·²ä¼˜æƒ </text>
        <text class="price-value discount">-Â¥{{discountPrice}}</text>
      </view>
      <view class="price-row total">
        <text class="price-label">æ€»è®¡</text>
        <text class="price-value">Â¥{{payPrice}}</text>
      </view>
    </view>
    
    <!-- æ¸©é¦¨æç¤º -->
    <view class="notice-section">
      <text class="notice-title">æ¸©é¦¨æç¤º</text>
      <text class="notice-text">å¦‚æœ‰åŸºç¡€ç–¾ç—…æˆ–èº«ä½“ä¸é€‚ï¼Œè¯·å‹¿å‚åŠ æœ¬è¿åŠ¨é¡¹ç›®ã€‚å¦‚æœªå‘ŠçŸ¥è€Œå‚åŠ ï¼Œåæœéœ€è‡ªè¡Œæ‰¿æ‹…ã€‚</text>
    </view>
    
    <!-- åè®® -->
    <view class="agreement-section">
      <checkbox-group bindchange="onAgreementChange">
        <label class="agreement-label">
          <checkbox value="agreed" checked="{{agreed}}"/>
          <text>æˆ‘å·²é˜…è¯»å¹¶åŒæ„</text>
          <text class="agreement-link">ã€Šä¹‰åŸä¸Šé—¨æ•™è‚²ç”¨æˆ·åè®®ã€‹</text>
        </label>
      </checkbox-group>
    </view>
    
    <view class="bottom-placeholder"></view>
  </block>
</view>

<view class="bottom-bar" wx:if="{{course}}">
  <view class="bar-price">
    <text class="bar-label">åˆè®¡</text>
    <text class="bar-amount">Â¥{{payPrice || '0.00'}}</text>
  </view>
  <button 
    class="pay-btn {{!agreed || selectedStudents.length === 0 ? 'disabled' : ''}}"
    bindtap="onSubmit"
    disabled="{{submitting}}"
  >
    {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}}
  </button>
</view>
