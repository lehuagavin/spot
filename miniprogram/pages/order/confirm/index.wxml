<!-- åŠ å…¥æ‹¼ç­é¡µé¢ -->
<view class="page-container">
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
  </view>
  
  <block wx:elif="{{course}}">
    <!-- è¯¾ç¨‹å¡ç‰‡ -->
    <view class="course-card">
      <view class="course-header">
        <text class="course-name">{{course.name}}</text>
        <view class="status-tag {{course.status === 'ongoing' ? 'ongoing' : ''}}">
          {{course.status === 'ongoing' ? 'è¿›è¡Œä¸­' : course.status === 'enrolling' ? 'æŠ¥åä¸­' : 'å·²ç»“æŸ'}}
        </view>
      </view>
      <view class="course-meta">
        <view class="week-tag">æ€»å‘¨æœŸ{{course.total_weeks || 10}}å‘¨, å½“å‰ç¬¬{{course.current_week || 1}}å‘¨</view>
        <text class="slots-text">å‰©ä½™{{remainingSlots}}åé¢æ‹¼æ»¡</text>
      </view>
      <view class="course-info-row">
        <view class="info-icon-wrapper">
          <text class="info-icon-text">ğŸ•</text>
        </view>
        <text class="info-text">{{courseScheduleText}}</text>
      </view>
      <view class="course-info-row">
        <view class="info-icon-wrapper">
          <text class="info-icon-text">ğŸ“</text>
        </view>
        <text class="info-text">{{course.community_name || course.location}}</text>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹åç§°æ ‡é¢˜ -->
    <view class="section-title-row">
      <text class="section-main-title">{{course.name}}</text>
    </view>
    
    <!-- é€‰æ‹©å­¦å‘˜ -->
    <view class="student-section">
      <view class="select-student-row" bindtap="onSelectStudent">
        <text class="select-label">è¯·é€‰æ‹©åŠ å…¥æ‹¼ç­çš„å­¦å‘˜</text>
        <text class="arrow-icon">â€º</text>
      </view>
    </view>
    
    <!-- å·²é€‰å­¦å‘˜åˆ—è¡¨ -->
    <view class="selected-students" wx:if="{{selectedStudents.length > 0}}">
      <view class="student-item" wx:for="{{selectedStudents}}" wx:key="id">
        <view class="student-row">
          <text class="student-name">{{item.name}}</text>
          <text class="insurance-tag">å…è´¹èµ é€ä¿é™©</text>
        </view>
        <view class="price-row">
          <view class="price-type">
            <view class="price-check {{item.is_new ? 'active' : ''}}">
              <text class="check-icon" wx:if="{{item.is_new}}">âœ“</text>
            </view>
            <text class="price-type-label">æ–°äººä»·</text>
          </view>
          <view class="price-values">
            <text class="price-original">åŸä»·: Â¥{{course.price}}</text>
            <text class="price-current">Â¥{{item.actualPrice}}</text>
          </view>
        </view>
        <view class="discount-row">
          <text class="discount-text">å·²ä¼˜æƒ  <text class="discount-amount">Â¥{{item.discountAmount}}</text></text>
          <text class="subtotal-text">å°è®¡ <text class="subtotal-amount">Â¥{{item.actualPrice}}</text></text>
        </view>
      </view>
    </view>
    
    <!-- æ€»è®¡é‡‘é¢ -->
    <view class="total-section" wx:if="{{selectedStudents.length > 0}}">
      <text class="total-label">æ€»è®¡:</text>
      <text class="total-amount">Â¥ {{payPrice}}</text>
    </view>
    
    <!-- æ¸©é¦¨æç¤º -->
    <view class="notice-section">
      <text class="notice-text">æ¸©é¦¨æç¤º:å¦‚æœ‰åŸºç¡€ç–¾ç—…æˆ–èº«ä½“ä¸é€‚ï¼Œè¯·å‹¿å‚åŠ æœ¬è¿åŠ¨é¡¹ç›®ã€‚å¦‚æœªå‘ŠçŸ¥è€Œå‚åŠ ï¼Œåæœéœ€è‡ªè¡Œæ‰¿æ‹…ã€‚</text>
    </view>
    
    <!-- åè®® -->
    <view class="agreement-section">
      <view class="agreement-row" bindtap="onAgreementTap">
        <view class="agreement-checkbox {{agreed ? 'checked' : ''}}">
          <view class="checkbox-inner" wx:if="{{agreed}}"></view>
        </view>
        <text class="agreement-text">åŒæ„</text>
        <text class="agreement-link" catchtap="onViewAgreement">ã€Šå®¶é—¨å£ç”¨æˆ·åè®®ã€‹</text>
      </view>
    </view>
    
    <view class="bottom-placeholder"></view>
  </block>
</view>

<!-- åº•éƒ¨æŒ‰é’® -->
<view class="bottom-bar" wx:if="{{course}}">
  <button 
    class="pay-btn {{!agreed || selectedStudents.length === 0 ? 'disabled' : ''}}"
    bindtap="onSubmit"
    disabled="{{submitting || !agreed || selectedStudents.length === 0}}"
  >
    {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}}
  </button>
</view>
