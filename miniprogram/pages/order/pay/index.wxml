<!-- ç¡®è®¤æ”¯ä»˜é¡µé¢ -->
<view class="page-container">
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
  </view>
  
  <block wx:elif="{{order}}">
    <!-- çŠ¶æ€æç¤ºåŒºåŸŸ -->
    <view class="status-section">
      <view class="status-title">ç­‰å¾…ç”¨æˆ·æ”¯ä»˜</view>
      <view class="countdown-text">
        è®¢å•{{countdownMinutes}} åˆ†{{countdownSeconds}} ç§’åå°†è‡ªåŠ¨å–æ¶ˆ
      </view>
    </view>
    
    <!-- è¯¾ç¨‹å¡ç‰‡ -->
    <view class="course-card">
      <view class="course-header">
        <text class="course-name">{{order.course_name || 'æ™®é€š-è¿åŠ¨è¯¾1.5h'}}</text>
        <view class="status-tag {{order.course_status === 'ongoing' ? 'ongoing' : ''}}">
          {{order.course_status === 'ongoing' ? 'è¿›è¡Œä¸­' : order.course_status === 'enrolling' ? 'æŠ¥åä¸­' : 'è¿›è¡Œä¸­'}}
        </view>
      </view>
      <view class="course-meta">
        <view class="week-tag">æ€»å‘¨æœŸ{{order.total_weeks || 2}}å‘¨, å½“å‰ç¬¬{{order.current_week || 1}}å‘¨</view>
        <text class="slots-text">å‰©ä½™{{order.remaining_slots || 3}}åé¢æ‹¼æ»¡</text>
      </view>
      <view class="course-info-row">
        <view class="info-icon-wrapper">
          <text class="info-icon-text">ğŸ•</text>
        </view>
        <text class="info-text">{{order.schedule || '2026-02-02 æ˜ŸæœŸä¸€ 16:10~17:40'}}</text>
      </view>
      <view class="course-info-row">
        <view class="info-icon-wrapper">
          <text class="info-icon-text">ğŸ“</text>
        </view>
        <text class="info-text">{{order.location || 'æµ·æ²§å¤©å¿ƒå²›'}}</text>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹åç§°å’Œä»·æ ¼ -->
    <view class="price-header">
      <text class="course-title">{{order.course_name || 'æ™®é€š-è¿åŠ¨è¯¾1.5h'}}</text>
      <text class="unit-price">Â¥{{order.unit_price || '120.00'}}/ä½</text>
    </view>
    
    <!-- å­¦å‘˜åˆ—è¡¨ -->
    <view class="students-section">
      <view class="student-item" wx:for="{{order.students || [{name: 'é™ˆä¹å', is_new: true, price: 29.9, discount: 90.1}]}}" wx:key="index">
        <view class="student-header">
          <text class="student-name">{{item.name}}</text>
        </view>
        <view class="price-row">
          <text class="price-type">{{item.is_new ? 'æ–°äººä»·' : 'ä¼šå‘˜ä»·'}}</text>
          <text class="price-value">Â¥{{item.price}}</text>
        </view>
        <view class="discount-row">
          <text class="discount-text">å·²ä¼˜æƒ  <text class="discount-amount">Â¥{{item.discount}}</text></text>
          <text class="subtotal-text">å°è®¡ <text class="subtotal-amount">Â¥{{item.price}}</text></text>
        </view>
      </view>
    </view>
    
    <!-- æ€»è®¡é‡‘é¢ -->
    <view class="total-section">
      <text class="total-label">æ€»è®¡:</text>
      <text class="total-amount">Â¥ {{order.pay_amount || '29.90'}}</text>
    </view>
    
    <!-- æ¸©é¦¨æç¤º -->
    <view class="notice-section">
      <view class="notice-content">
        è´­ä¹°æ—¶ï¼Œå¦‚é‡åˆ°æ‹¼ç­æœªæˆåŠŸçš„æƒ…å†µï¼Œç›¸åº”çš„é‡‘é¢ä¼šè‡ªåŠ¨åŸè·¯é€€å›ï¼Œé€€æ¬¾æ—¶é—´å¯èƒ½æœ‰å‡ ç§’å»¶è¿Ÿï¼Œè¯·è€å¿ƒç­‰å€™ï¼Œæ”¯ä»˜æ—¶å¦‚ç½‘ç»œçŠ¶æ€ä¸ä½³(å¦‚:ç½‘ç»œè¶…æ—¶)å¯é€€å‡ºæŸ¥çœ‹æ‹¼ç­è®°å½•ï¼Œè¯·å‹¿å¤šæ¬¡æ”¯ä»˜ä»¥å…é€ æˆæŸå¤±ï¼Œå¦‚éœ€å¸®åŠ©è¯·è”ç³»å®¢æœã€‚
      </view>
    </view>
    
    <view class="bottom-placeholder"></view>
  </block>
</view>

<!-- åº•éƒ¨æŒ‰é’® -->
<view class="bottom-bar" wx:if="{{order}}">
  <button class="cancel-btn" bindtap="onCancel">å–æ¶ˆè®¢å•</button>
  <button class="pay-btn" bindtap="onShowPayModal" disabled="{{paying}}">
    {{paying ? 'æ”¯ä»˜ä¸­...' : 'ç«‹å³æ”¯ä»˜'}}
  </button>
</view>

<!-- æ”¯ä»˜æ–¹å¼å¼¹çª— -->
<view class="pay-modal-mask" wx:if="{{showPayModal}}" bindtap="onHidePayModal"></view>
<view class="pay-modal {{showPayModal ? 'show' : ''}}">
  <view class="modal-header">
    <view class="modal-close" bindtap="onHidePayModal">Ã—</view>
  </view>
  <view class="modal-body">
    <view class="pay-icon-wrapper">
      <text class="pay-icon-text">âœ“</text>
    </view>
    <text class="pay-title">è®¢å•æ”¯ä»˜</text>
    
    <button class="pay-option-btn primary" bindtap="onPayToPhone">
      å‘é€åˆ°æ‰‹æœºå¾®ä¿¡æ”¯ä»˜
    </button>
    
    <view class="pay-option-link" bindtap="onPayByQrcode">
      äºŒç»´ç æ”¯ä»˜
    </view>
  </view>
</view>
