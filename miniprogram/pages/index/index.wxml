<!-- 首页 -->
<view class="page-container">
  <!-- 轮播图 -->
  <view class="banner-section">
    <swiper 
      class="banner-swiper"
      indicator-dots
      indicator-color="rgba(255,255,255,0.4)"
      indicator-active-color="#ffffff"
      autoplay
      circular
    >
      <swiper-item 
        wx:for="{{banners}}" 
        wx:key="id"
        bindtap="onBannerTap"
        data-item="{{item}}"
      >
        <view 
          class="banner-item"
          style="background: linear-gradient(135deg, {{item.color || '#667eea'}} 0%, {{item.color2 || '#764ba2'}} 100%);"
        >
          <image 
            wx:if="{{item.image && !item.imageError}}"
            class="banner-image" 
            src="{{item.image}}" 
            mode="aspectFill"
            binderror="onBannerImageError"
            data-index="{{index}}"
          />
          <view class="banner-content" wx:if="{{!item.image || item.imageError}}">
            <text class="banner-title">{{item.title}}</text>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>
  
  <!-- 筛选区域 -->
  <view class="filter-section">
    <!-- 标题行 -->
    <view class="filter-header">
      <view class="filter-title">
        <text class="title-main">小区拼班</text>
        <text class="title-sub">{{selectedCommunity.name || '全部小区'}}</text>
      </view>
      <view class="location-btn" bindtap="onLocationTap">
        <text class="location-icon">📍</text>
        <text class="location-text">{{selectedCommunity ? '切换' : '定位'}}</text>
      </view>
    </view>
    
    <!-- 状态筛选标签 -->
    <view class="filter-tabs">
      <view 
        wx:for="{{filterTabs}}" 
        wx:key="key"
        class="filter-tab {{currentFilter === item.key ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-key="{{item.key}}"
      >
        {{item.label}}
      </view>
    </view>
  </view>
  
  <!-- 课程列表 -->
  <view class="course-section">
    <!-- 加载中 -->
    <view class="loading-state" wx:if="{{loading && courses.length === 0}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 课程列表 -->
    <view class="course-list" wx:elif="{{courses.length > 0}}">
      <course-card 
        wx:for="{{courses}}" 
        wx:key="id"
        course="{{item}}"
        bind:join="onCourseJoin"
      />
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:else>
      <view class="empty-icon">📚</view>
      <text class="empty-text">暂无课程</text>
      <text class="empty-hint">换个小区试试吧</text>
    </view>
    
    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{loadingMore}}">
      <view class="loading-spinner small"></view>
      <text class="load-more-text">加载更多...</text>
    </view>
    
    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && courses.length > 0}}">
      <text class="no-more-text">- 没有更多了 -</text>
    </view>
  </view>
</view>

<!-- 隐私协议弹窗 -->
<privacy-modal 
  show="{{showPrivacy}}" 
  bind:agree="onPrivacyAgree"
/>

<!-- 位置授权弹窗 -->
<location-auth 
  show="{{showLocationAuth}}"
  bind:success="onLocationSuccess"
  bind:skip="onLocationSkip"
  bind:denied="onLocationDenied"
/>
