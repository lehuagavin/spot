<!-- è¯¾ç¨‹è¯¦æƒ…é¡µé¢ -->
<view class="page-container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <block wx:elif="{{course}}">
    <!-- å¤´éƒ¨è¯¾ç¨‹å›¾ç‰‡ -->
    <view class="course-banner {{course.image ? '' : 'no-image'}}">
      <image 
        wx:if="{{course.image}}"
        class="banner-image" 
        src="{{course.image}}" 
        mode="aspectFill"
      />
      <view class="banner-overlay" wx:if="{{!course.image}}">
        <view class="brand-logo">
          <text class="logo-text">ä¹‰åŸä¸Šé—¨æ•™è‚²</text>
          <text class="logo-sub">YICHENG HOME EDUCATION</text>
        </view>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹æ ‡é¢˜åŒº -->
    <view class="title-section">
      <view class="title-left">
        <text class="course-name">{{course.name}}</text>
        <text class="teacher-info">ä¸Šè¯¾è€å¸ˆï¼š{{course.teacher.name || 'å¾…å®š'}}</text>
      </view>
      <button class="share-btn" open-type="share">
        <text class="share-icon">â†—</text>
        <text>åˆ†äº«</text>
      </button>
    </view>
    
    <!-- å‘¨æ•°çŠ¶æ€æ ‡ç­¾ -->
    <view class="week-tag-section">
      <view class="week-tag">
        <text class="week-num">ç¬¬{{course.current_week || 1}}å‘¨</text>
        <text class="week-status">{{course.status === 'enrolling' ? 'æŠ¥åä¸­' : course.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}</text>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹ä¿¡æ¯åˆ—è¡¨ -->
    <view class="info-section">
      <view class="info-row">
        <view class="info-icon">ğŸ“…</view>
        <text class="info-label">ä¸Šè¯¾å‘¨æœŸï¼š</text>
        <text class="info-value">å…±{{course.total_weeks || 1}}å‘¨ï¼Œ{{course.total_lessons || 1}}èŠ‚è¯¾</text>
      </view>
      <view class="info-row">
        <view class="info-icon">ğŸ•</view>
        <text class="info-label">ä¸Šè¯¾æ—¶æ®µï¼š</text>
        <text class="info-value">{{course.schedule || 'å¾…å®š'}}</text>
      </view>
      <view class="info-row">
        <view class="info-icon">ğŸ </view>
        <text class="info-label">ä¸Šè¯¾å°åŒºï¼š</text>
        <text class="info-value">{{course.community_name || 'å¾…å®š'}}</text>
      </view>
      <view class="info-row" wx:if="{{course.class_no}}">
        <view class="info-icon">ğŸ”¢</view>
        <text class="info-label">ç­çº§å·ï¼š</text>
        <text class="info-value">{{course.class_no}}</text>
      </view>
      <view class="info-row address-row">
        <view class="address-left">
          <view class="info-icon">ğŸ“</view>
          <text class="info-label">ä¸Šè¯¾åœ°å€ï¼š</text>
          <text class="info-value address-text">{{course.location || course.address || 'å¾…å®š'}}</text>
        </view>
        <view class="nav-btn" bindtap="onNavigate">
          <text class="nav-icon">â†—</text>
          <text>å¯¼èˆª</text>
        </view>
      </view>
      <view class="info-row">
        <view class="info-icon">â°</view>
        <text class="info-label">æˆç­æˆªæ­¢æ—¶é—´ï¼š</text>
        <text class="info-value deadline">{{course.deadline}}</text>
      </view>
    </view>
    
    <!-- ä»·æ ¼åŒºåŸŸ -->
    <view class="price-section">
      <view class="price-header">
        <text class="price-label">è¯¾ç¨‹å•ä»·</text>
        <view class="price-value">
          <text class="price-symbol">Â¥</text>
          <text class="price-amount">{{course.member_price || course.price || 0}}</text>
          <text class="price-unit">/èŠ‚</text>
        </view>
      </view>
      
      <!-- ä¼šå‘˜æƒç›Šå¡ -->
      <view class="member-card">
        <view class="member-card-header">
          <view class="member-title">
            <text class="member-icon">ğŸ’›</text>
            <text class="member-text">å„¿ç«¥æƒç›Šå¡</text>
          </view>
          <view class="recommend-tag">æ¨è</view>
        </view>
        <view class="member-price-row">
          <text class="member-price-label">ä¼šå‘˜ä¸“äº«ä»·æ ¼</text>
          <view class="member-price-value">
            <text class="member-price-num">{{course.price || 0}}</text>
            <text class="member-price-unit">å…ƒ/èŠ‚</text>
          </view>
        </view>
        <view class="member-saving">
          <text>ä¼šå‘˜æƒç›Šå¡æ¯èŠ‚è¯¾ä¸ºæ‚¨èŠ‚çœ</text>
          <text class="saving-amount">-{{savingAmount}}</text>
          <text class="saving-unit">å…ƒ</text>
        </view>
      </view>
    </view>
    
    <!-- ç­çº§æŠ¥åä¿¡æ¯ -->
    <view class="enroll-section">
      <view class="enroll-header">
        <text class="enroll-class">{{course.max_students || 10}}äººç­</text>
        <text class="enroll-time">{{course.start_date}} {{course.schedule_time || ''}}</text>
        <text class="enroll-status {{course.status}}">{{course.status === 'enrolling' ? 'æŠ¥åä¸­' : course.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}</text>
      </view>
      
      <view class="enroll-progress">
        <text>æ»¡{{course.min_students || 1}}äººæˆç­ï¼Œå‰©ä½™</text>
        <text class="remaining-count">{{remainingSlots}}</text>
        <text>ä¸ªåé¢</text>
      </view>
      
      <!-- å·²æŠ¥åå­¦å‘˜å¤´åƒ -->
      <view class="enrolled-avatars">
        <view 
          class="avatar-item"
          wx:for="{{course.max_students || 10}}"
          wx:key="index"
        >
          <image 
            wx:if="{{enrolledStudents[index] && enrolledStudents[index].avatar}}" 
            src="{{enrolledStudents[index].avatar}}" 
            mode="aspectFill"
          />
          <view wx:else class="avatar-placeholder"></view>
        </view>
      </view>
    </view>
    
    <!-- æ‹¼ç­è¯´æ˜ -->
    <view class="notice-section">
      <view class="notice-title">
        <view class="title-bar"></view>
        <text>æ‹¼ç­è¯´æ˜</text>
      </view>
      <view class="notice-content">
        <text class="notice-subtitle">æ‹¼ç­è¯´æ˜ï¼š</text>
        <text class="notice-text">1ã€æ”¯ä»˜æˆåŠŸåˆ™è§†ä¸ºæ‹¼ç­æˆåŠŸã€‚</text>
        <text class="notice-text">2ã€æ‰€æ”¯ä»˜çš„è´¹ç”¨ä¸ºè¯¥äº§å“çš„å®é™…ä»·æ ¼ã€‚</text>
        <text class="notice-text">3ã€æŠ¥åæ—¶é—´æˆªæ­¢å‰éšæ—¶å¯ç”³è¯·é€€æ¬¾ï¼ŒæŠ¥åæ—¶é—´æˆªæ­¢åè´¹ç”¨ä¸å¯é€€ã€‚</text>
        <text class="notice-text">4ã€è‹¥é‡åˆ°ä¸å¯æŠ—æ‹’å› ç´ ï¼ˆå¤©æ°”ã€ç­çº§ä¸æ»¡æœ€ä½äººæ•°ç­‰ï¼‰è¯¥ç­çº§è§£æ•£ï¼Œæ¬¾é¡¹å°†åœ¨10åˆ†é’Ÿå†…è‡ªåŠ¨åŸè·¯è¿”è¿˜ï¼Œæ— éœ€æ“ä½œã€‚</text>
      </view>
    </view>
    
    <!-- é€€æ¬¾æ”¿ç­– -->
    <view class="notice-section">
      <view class="notice-title">
        <view class="title-bar"></view>
        <text>é€€æ¬¾æ”¿ç­–</text>
      </view>
      <view class="notice-content">
        <text class="notice-subtitle">é€€æ¬¾æ”¿ç­–ï¼š</text>
        <text class="notice-text">1ã€æŠ¥åæ—¶é—´æˆªæ­¢å‰éšæ—¶å¯ç”³è¯·é€€æ¬¾ï¼ŒæŠ¥åæ—¶é—´æˆªæ­¢åè´¹ç”¨ä¸å¯é€€ã€‚</text>
        <text class="notice-text">2ã€è‹¥é‡åˆ°ä¸å¯æŠ—æ‹’å› ç´ ï¼ˆå¤©æ°”ã€ç­çº§ä¸æ»¡æœ€ä½äººæ•°ç­‰ï¼‰è¯¥ç­çº§è§£æ•£ï¼Œæ¬¾é¡¹å°†åœ¨10åˆ†é’Ÿå†…è‡ªåŠ¨åŸè·¯è¿”è¿˜ï¼Œæ— éœ€æ“ä½œã€‚</text>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹ç®€ä»‹ -->
    <view class="notice-section" wx:if="{{course.description}}">
      <view class="notice-title">
        <view class="title-bar"></view>
        <text>è¯¾ç¨‹ç®€ä»‹</text>
      </view>
      <view class="notice-content">
        <text class="notice-subtitle">{{course.name}}</text>
        <text class="notice-text">{{course.description}}</text>
      </view>
    </view>
    
    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-placeholder"></view>
  </block>
</view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-bar" wx:if="{{course}}">
  <button 
    class="join-btn {{remainingSlots <= 0 || course.status !== 'enrolling' ? 'disabled' : ''}}"
    bindtap="onJoinClass"
  >
    {{remainingSlots <= 0 ? 'åé¢å·²æ»¡' : course.status !== 'enrolling' ? 'æš‚ä¸å¯æŠ¥å' : 'åŠ å…¥æ‹¼ç­'}}
  </button>
</view>
