# 义城上门教育 - 开发计划

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | 义城上门教育 (Yicheng Home Education) |
| 版本 | v1.0 (MVP) |
| 文档类型 | 开发计划 |
| 文档状态 | 初稿 |

---

## 开发原则

1. **阶段可测试**: 每个阶段完成后都能独立测试验证
2. **增量交付**: 每个阶段在上一阶段基础上增量开发
3. **文档同步**: 每个阶段完成后输出阶段总结和测试文档
4. **接口优先**: 后端 API 先行，前端依赖接口开发

---

## 阶段概览

| 阶段 | 名称 | 主要内容 | 验证方式 |
|------|------|----------|----------|
| 1 | 项目初始化 | 环境搭建、项目结构 | 服务可启动 |
| 2 | 数据库与基础服务 | 数据表、ORM、基础工具 | 数据库可操作 |
| 3 | 后端 API 开发 | 所有小程序+管理端接口 | Swagger/Postman 测试 |
| 4 | 管理后台 Web | React 管理系统 | 浏览器可操作 |
| 5 | 微信小程序 | 用户端小程序 | 真机/模拟器测试 |

---

## 阶段 1: 项目初始化与环境搭建

### 1.1 目标

搭建完整的本地开发环境，初始化前后端项目结构，确保开发工具链可用。

### 1.2 任务清单

#### 1.2.1 后端项目初始化

- [ ] 使用 uv 初始化 Python 项目
- [ ] 配置 FastAPI 项目结构
- [ ] 配置 SQLAlchemy 异步数据库连接
- [ ] 配置 Pydantic Settings 环境变量管理
- [ ] 配置 loguru 日志系统
- [ ] 创建健康检查接口 `/health`
- [ ] 配置 CORS 中间件
- [ ] 配置 Swagger 文档 (`/docs`)

#### 1.2.2 管理后台项目初始化

- [ ] 使用 Vite 初始化 React + TypeScript 项目
- [ ] 配置 Ant Design 5.x 组件库
- [ ] 配置 React Router 6 路由
- [ ] 配置 Zustand 状态管理
- [ ] 配置 Axios 请求封装
- [ ] 创建基础布局组件

#### 1.2.3 小程序项目初始化

- [ ] 创建微信小程序项目
- [ ] 配置 Vant Weapp 组件库
- [ ] 配置 MobX 状态管理
- [ ] 配置请求封装和拦截器
- [ ] 创建基础页面结构
- [ ] 配置 TabBar 导航

#### 1.2.4 开发环境配置

- [ ] 安装配置 MySQL 8.0
- [ ] 执行数据库脚本sqls/spot.sql
- [ ] 创建本地文件存储目录 `uploads/`
- [ ] 配置 `.env` 环境变量文件

### 1.3 目录结构

```
yicheng/
├── backend/                    # 后端服务
│   ├── src/
│   │   ├── api/               # API 路由
│   │   │   ├── v1/            # API v1 版本
│   │   │   └── deps.py        # 依赖注入
│   │   ├── core/              # 核心配置
│   │   │   ├── config.py      # 配置管理
│   │   │   ├── security.py    # 安全相关
│   │   │   └── database.py    # 数据库连接
│   │   ├── models/            # 数据模型
│   │   │   ├── domain/        # ORM 模型
│   │   │   └── schemas/       # Pydantic 模型
│   │   ├── services/          # 业务逻辑
│   │   ├── repositories/      # 数据访问
│   │   └── utils/             # 工具函数
│   ├── tests/                 # 测试
│   ├── uploads/               # 文件存储
│   ├── pyproject.toml
│   └── .env
│
├── miniprogram/               # 微信小程序
│   ├── components/            # 公共组件
│   ├── pages/                 # 页面
│   ├── services/              # API 服务
│   ├── store/                 # 状态管理
│   ├── utils/                 # 工具函数
│   ├── app.js
│   ├── app.json
│   └── app.wxss
│
├── admin-web/                 # 管理后台
│   ├── src/
│   │   ├── api/               # API 接口
│   │   ├── components/        # 公共组件
│   │   ├── pages/             # 页面
│   │   ├── store/             # 状态管理
│   │   ├── router/            # 路由配置
│   │   ├── hooks/             # 自定义 Hooks
│   │   ├── types/             # 类型定义
│   │   └── utils/             # 工具函数
│   ├── package.json
│   └── vite.config.ts
│
├── docs/                      # 阶段文档
├── specs/                     # 规格说明
└── README.md
```

### 1.4 验收标准

| 检查项 | 验收条件 |
|--------|----------|
| 后端服务 | `uv run uvicorn src.main:app --reload` 正常启动，端口 8000 |
| 健康检查 | GET `http://localhost:8000/health` 返回 `{"status": "ok"}` |
| API 文档 | 浏览器访问 `http://localhost:8000/docs` 显示 Swagger UI |
| 数据库 | MySQL 连接正常，`spot` 数据库已创建 |
| 管理后台 | `npm run dev` 启动，浏览器访问 `http://localhost:5173` 显示页面 |
| 小程序 | 微信开发者工具可打开项目，编译无报错 |

### 1.5 测试内容

| 测试项 | 测试方法 | 预期结果 |
|--------|----------|----------|
| 后端启动 | 执行启动命令 | 无报错，显示 Uvicorn running |
| 健康检查 | curl 或浏览器访问 | 返回 JSON `{"status": "ok"}` |
| 数据库连接 | 后端启动时检查日志 | 无连接错误 |
| 管理后台启动 | npm run dev | 无报错，浏览器可访问 |
| 小程序编译 | 开发者工具编译 | 无报错，模拟器显示页面 |

### 1.6 阶段产出

- 完成文档: `docs/phase-01-summary.md`
- 代码提交: `feat: 项目初始化与环境搭建`

---

## 阶段 2: 数据库与基础服务

### 2.1 目标

创建所有数据库表，实现 ORM 模型、基础工具类和通用服务。

### 2.2 任务清单

#### 2.2.1 数据库表创建

- [ ] 用户表 (users)
- [ ] 学员表 (students)
- [ ] 小区表 (communities)
- [ ] 教练表 (teachers)
- [ ] 课程表 (courses)
- [ ] 订单表 (orders)
- [ ] 课程学员关联表 (course_students)
- [ ] 支付记录表 (payments)
- [ ] 权益卡表 (member_cards)
- [ ] 用户会员表 (user_members)
- [ ] 轮播图表 (banners)
- [ ] 管理员表 (admins)

#### 2.2.2 ORM 模型定义

- [ ] 定义所有 SQLAlchemy 模型 (`src/models/domain/`)
- [ ] 配置模型关系 (外键、关联)
- [ ] 定义 Pydantic Schema (`src/models/schemas/`)
- [ ] 实现模型与 Schema 转换

#### 2.2.3 基础工具实现

- [ ] ID 生成器 (UUID/雪花算法)
- [ ] 时间处理工具
- [ ] 分页查询工具
- [ ] 密码加密工具 (bcrypt)
- [ ] 身份证加密工具 (AES-256)
- [ ] 数据脱敏工具

#### 2.2.4 基础服务实现

- [ ] Repository 基类 (通用 CRUD)
- [ ] Service 基类
- [ ] 统一响应格式
- [ ] 错误码枚举定义
- [ ] 全局异常处理器
- [ ] 请求日志中间件

#### 2.2.5 数据库迁移

- [ ] 创建初始化 SQL 脚本
- [ ] 插入默认管理员账号
- [ ] 插入测试数据 (可选)

### 2.3 数据库初始化脚本

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS yicheng_dev
  DEFAULT CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;

USE yicheng_dev;

-- 管理员表
CREATE TABLE admins (
  id VARCHAR(32) PRIMARY KEY,
  username VARCHAR(64) NOT NULL UNIQUE,
  password_hash VARCHAR(128) NOT NULL,
  name VARCHAR(64) NOT NULL,
  status TINYINT(1) DEFAULT 1,
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL
);

-- 初始化管理员账号 (密码: admin123)
INSERT INTO admins (id, username, password_hash, name, status, created_at, updated_at)
VALUES (
  'admin_001',
  'admin',
  '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/X4.VTtYr6D1HwXHHm',
  '系统管理员',
  1,
  NOW(),
  NOW()
);

-- 其他表结构见设计文档 specs/0002-design.md
```

### 2.4 统一响应格式

```python
# 成功响应
{
  "code": 0,
  "message": "success",
  "data": { ... }
}

# 错误响应
{
  "code": 10001,
  "message": "用户不存在",
  "data": null
}

# 分页响应
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

### 2.5 验收标准

| 检查项 | 验收条件 |
|--------|----------|
| 数据表 | 所有 12 张表创建成功 |
| ORM 模型 | 所有模型定义完成，无语法错误 |
| 基础 CRUD | Repository 基类可执行增删改查 |
| 统一响应 | API 返回格式符合规范 |
| 异常处理 | 异常能被正确捕获并返回错误码 |
| 日志记录 | 请求日志正常输出 |
| 管理员 | 默认管理员账号可查询到 |

### 2.6 测试内容

| 测试项 | 测试方法 | 预期结果 |
|--------|----------|----------|
| DDL 执行 | 运行初始化脚本 | 所有表创建成功 |
| ORM 查询 | Python 脚本测试 | 可正常查询数据 |
| CRUD 操作 | Repository 单元测试 | 增删改查正常 |
| 密码加密 | 调用加密/验证函数 | 加密后可验证 |
| 异常捕获 | 触发异常请求 | 返回统一错误格式 |

### 2.7 阶段产出

- 完成文档: `docs/phase-02-summary.md`
- 代码提交: `feat: 数据库设计与基础服务实现`

---

## 阶段 3: 后端 API 开发

### 3.1 目标

实现所有后端 API 接口，包括小程序端接口和管理端接口，所有接口可通过 Swagger 或 Postman 测试。

### 3.2 任务清单

#### 3.2.1 认证模块

**小程序端:**
- [ ] `POST /api/v1/auth/wechat/login` - 微信登录
- [ ] `POST /api/v1/auth/wechat/bindPhone` - 绑定手机号
- [ ] `PUT /api/v1/auth/user/info` - 更新用户信息

**管理端:**
- [ ] `POST /api/v1/admin/auth/login` - 管理员登录
- [ ] `POST /api/v1/admin/auth/logout` - 管理员登出
- [ ] `GET /api/v1/admin/auth/info` - 获取管理员信息

**通用:**
- [ ] JWT Token 生成与验证
- [ ] 认证中间件
- [ ] Token 刷新机制

#### 3.2.2 用户模块

**小程序端:**
- [ ] `GET /api/v1/user/info` - 获取用户信息
- [ ] `GET /api/v1/user/assets` - 获取用户资产

**管理端:**
- [ ] `GET /api/v1/admin/users` - 用户列表
- [ ] `GET /api/v1/admin/users/{id}` - 用户详情
- [ ] `PUT /api/v1/admin/users/{id}/status` - 更新用户状态

#### 3.2.3 学员模块

**小程序端:**
- [ ] `GET /api/v1/students` - 学员列表
- [ ] `POST /api/v1/students` - 添加学员
- [ ] `PUT /api/v1/students/{id}` - 更新学员
- [ ] `DELETE /api/v1/students/{id}` - 删除学员

**管理端:**
- [ ] `GET /api/v1/admin/students` - 学员列表
- [ ] `GET /api/v1/admin/students/{id}` - 学员详情

#### 3.2.4 小区模块

**小程序端:**
- [ ] `GET /api/v1/communities` - 小区列表
- [ ] `GET /api/v1/communities/nearby` - 附近小区 (Haversine 距离计算)
- [ ] `GET /api/v1/communities/{id}` - 小区详情

**管理端:**
- [ ] `GET /api/v1/admin/communities` - 小区列表
- [ ] `POST /api/v1/admin/communities` - 创建小区
- [ ] `PUT /api/v1/admin/communities/{id}` - 更新小区
- [ ] `DELETE /api/v1/admin/communities/{id}` - 删除小区

#### 3.2.5 教练模块

**管理端:**
- [ ] `GET /api/v1/admin/teachers` - 教练列表
- [ ] `POST /api/v1/admin/teachers` - 创建教练
- [ ] `PUT /api/v1/admin/teachers/{id}` - 更新教练
- [ ] `DELETE /api/v1/admin/teachers/{id}` - 删除教练

#### 3.2.6 课程模块

**小程序端:**
- [ ] `GET /api/v1/courses` - 课程列表 (按小区、状态筛选)
- [ ] `GET /api/v1/courses/{id}` - 课程详情

**管理端:**
- [ ] `GET /api/v1/admin/courses` - 课程列表
- [ ] `POST /api/v1/admin/courses` - 创建课程
- [ ] `PUT /api/v1/admin/courses/{id}` - 更新课程
- [ ] `PUT /api/v1/admin/courses/{id}/status` - 更新课程状态
- [ ] `GET /api/v1/admin/courses/{id}/students` - 课程学员列表

#### 3.2.7 订单模块

**小程序端:**
- [ ] `POST /api/v1/orders` - 创建订单
- [ ] `GET /api/v1/orders` - 订单列表 (按状态筛选)
- [ ] `GET /api/v1/orders/{id}` - 订单详情
- [ ] `POST /api/v1/orders/{id}/cancel` - 取消订单
- [ ] `POST /api/v1/orders/{id}/refund` - 申请退款

**管理端:**
- [ ] `GET /api/v1/admin/orders` - 订单列表
- [ ] `GET /api/v1/admin/orders/{id}` - 订单详情
- [ ] `POST /api/v1/admin/orders/{id}/refund` - 处理退款

#### 3.2.8 支付模块

**小程序端:**
- [ ] `POST /api/v1/payment/prepay` - 获取支付参数
- [ ] `POST /api/v1/payment/callback` - 支付回调 (内部接口)

**说明:** 本地开发环境使用模拟支付，返回固定支付参数。

#### 3.2.9 会员模块

**小程序端:**
- [ ] `GET /api/v1/member/cards` - 权益卡列表
- [ ] `POST /api/v1/member/purchase` - 购买权益卡
- [ ] `GET /api/v1/member/status` - 会员状态查询

**管理端:**
- [ ] `GET /api/v1/admin/member/cards` - 权益卡列表
- [ ] `POST /api/v1/admin/member/cards` - 创建权益卡
- [ ] `PUT /api/v1/admin/member/cards/{id}` - 更新权益卡
- [ ] `GET /api/v1/admin/member/records` - 会员购买记录

#### 3.2.10 轮播图模块

**小程序端:**
- [ ] `GET /api/v1/banners` - 轮播图列表

**管理端:**
- [ ] `GET /api/v1/admin/banners` - 轮播图列表
- [ ] `POST /api/v1/admin/banners` - 创建轮播图
- [ ] `PUT /api/v1/admin/banners/{id}` - 更新轮播图
- [ ] `DELETE /api/v1/admin/banners/{id}` - 删除轮播图

#### 3.2.11 文件上传模块

**通用:**
- [ ] `POST /api/v1/upload/image` - 上传图片
- [ ] 图片本地存储
- [ ] 静态文件服务

#### 3.2.12 仪表盘模块

**管理端:**
- [ ] `GET /api/v1/admin/dashboard/stats` - 统计数据
- [ ] `GET /api/v1/admin/dashboard/recent-orders` - 最近订单

### 3.3 API 汇总表

#### 小程序端接口 (共 22 个)

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 认证 | POST | `/api/v1/auth/wechat/login` | 微信登录 |
| 认证 | POST | `/api/v1/auth/wechat/bindPhone` | 绑定手机号 |
| 认证 | PUT | `/api/v1/auth/user/info` | 更新用户信息 |
| 用户 | GET | `/api/v1/user/info` | 获取用户信息 |
| 用户 | GET | `/api/v1/user/assets` | 获取用户资产 |
| 学员 | GET | `/api/v1/students` | 学员列表 |
| 学员 | POST | `/api/v1/students` | 添加学员 |
| 学员 | PUT | `/api/v1/students/{id}` | 更新学员 |
| 学员 | DELETE | `/api/v1/students/{id}` | 删除学员 |
| 小区 | GET | `/api/v1/communities` | 小区列表 |
| 小区 | GET | `/api/v1/communities/nearby` | 附近小区 |
| 小区 | GET | `/api/v1/communities/{id}` | 小区详情 |
| 课程 | GET | `/api/v1/courses` | 课程列表 |
| 课程 | GET | `/api/v1/courses/{id}` | 课程详情 |
| 订单 | POST | `/api/v1/orders` | 创建订单 |
| 订单 | GET | `/api/v1/orders` | 订单列表 |
| 订单 | GET | `/api/v1/orders/{id}` | 订单详情 |
| 订单 | POST | `/api/v1/orders/{id}/cancel` | 取消订单 |
| 订单 | POST | `/api/v1/orders/{id}/refund` | 申请退款 |
| 支付 | POST | `/api/v1/payment/prepay` | 获取支付参数 |
| 会员 | GET | `/api/v1/member/cards` | 权益卡列表 |
| 会员 | POST | `/api/v1/member/purchase` | 购买权益卡 |
| 会员 | GET | `/api/v1/member/status` | 会员状态 |
| 轮播图 | GET | `/api/v1/banners` | 轮播图列表 |
| 上传 | POST | `/api/v1/upload/image` | 上传图片 |

#### 管理端接口 (共 32 个)

| 模块 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 认证 | POST | `/api/v1/admin/auth/login` | 管理员登录 |
| 认证 | POST | `/api/v1/admin/auth/logout` | 管理员登出 |
| 认证 | GET | `/api/v1/admin/auth/info` | 管理员信息 |
| 用户 | GET | `/api/v1/admin/users` | 用户列表 |
| 用户 | GET | `/api/v1/admin/users/{id}` | 用户详情 |
| 用户 | PUT | `/api/v1/admin/users/{id}/status` | 更新用户状态 |
| 学员 | GET | `/api/v1/admin/students` | 学员列表 |
| 学员 | GET | `/api/v1/admin/students/{id}` | 学员详情 |
| 小区 | GET | `/api/v1/admin/communities` | 小区列表 |
| 小区 | POST | `/api/v1/admin/communities` | 创建小区 |
| 小区 | PUT | `/api/v1/admin/communities/{id}` | 更新小区 |
| 小区 | DELETE | `/api/v1/admin/communities/{id}` | 删除小区 |
| 教练 | GET | `/api/v1/admin/teachers` | 教练列表 |
| 教练 | POST | `/api/v1/admin/teachers` | 创建教练 |
| 教练 | PUT | `/api/v1/admin/teachers/{id}` | 更新教练 |
| 教练 | DELETE | `/api/v1/admin/teachers/{id}` | 删除教练 |
| 课程 | GET | `/api/v1/admin/courses` | 课程列表 |
| 课程 | POST | `/api/v1/admin/courses` | 创建课程 |
| 课程 | PUT | `/api/v1/admin/courses/{id}` | 更新课程 |
| 课程 | PUT | `/api/v1/admin/courses/{id}/status` | 更新课程状态 |
| 课程 | GET | `/api/v1/admin/courses/{id}/students` | 课程学员 |
| 订单 | GET | `/api/v1/admin/orders` | 订单列表 |
| 订单 | GET | `/api/v1/admin/orders/{id}` | 订单详情 |
| 订单 | POST | `/api/v1/admin/orders/{id}/refund` | 处理退款 |
| 会员 | GET | `/api/v1/admin/member/cards` | 权益卡列表 |
| 会员 | POST | `/api/v1/admin/member/cards` | 创建权益卡 |
| 会员 | PUT | `/api/v1/admin/member/cards/{id}` | 更新权益卡 |
| 会员 | GET | `/api/v1/admin/member/records` | 会员记录 |
| 轮播图 | GET | `/api/v1/admin/banners` | 轮播图列表 |
| 轮播图 | POST | `/api/v1/admin/banners` | 创建轮播图 |
| 轮播图 | PUT | `/api/v1/admin/banners/{id}` | 更新轮播图 |
| 轮播图 | DELETE | `/api/v1/admin/banners/{id}` | 删除轮播图 |
| 仪表盘 | GET | `/api/v1/admin/dashboard/stats` | 统计数据 |
| 仪表盘 | GET | `/api/v1/admin/dashboard/recent-orders` | 最近订单 |

### 3.4 验收标准

| 检查项 | 验收条件 |
|--------|----------|
| Swagger 文档 | 所有接口在 `/docs` 可见 |
| 认证接口 | 登录获取 Token，Token 可用于访问受保护接口 |
| CRUD 接口 | 增删改查功能正常 |
| 分页查询 | 列表接口支持分页、搜索 |
| 错误处理 | 参数校验失败返回明确错误信息 |
| 接口测试 | 所有接口可通过 Postman/Swagger 测试通过 |

### 3.5 测试内容

使用 Swagger UI 或 Postman 测试所有接口:

| 测试类别 | 测试内容 |
|----------|----------|
| 认证测试 | 登录获取 Token、Token 验证、过期处理 |
| 权限测试 | 无 Token 访问受保护接口返回 401 |
| CRUD 测试 | 各模块增删改查功能 |
| 参数校验 | 必填参数缺失、格式错误处理 |
| 业务逻辑 | 订单状态流转、价格计算、距离计算 |
| 边界测试 | 空列表、不存在的 ID、重复操作 |

### 3.6 接口测试用例示例

```bash
# 1. 管理员登录
curl -X POST http://localhost:8000/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# 预期: {"code": 0, "data": {"token": "xxx", "expires_in": 7200}}

# 2. 创建小区 (需携带 Token)
curl -X POST http://localhost:8000/api/v1/admin/communities \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "name": "测试小区",
    "address": "测试地址",
    "latitude": 20.0,
    "longitude": 110.0
  }'

# 预期: {"code": 0, "data": {"id": "xxx", ...}}

# 3. 获取课程列表
curl http://localhost:8000/api/v1/courses?community_id=xxx&status=enrolling

# 预期: {"code": 0, "data": {"list": [...], "total": 10}}
```

### 3.7 阶段产出

- 完成文档: `docs/phase-03-summary.md`
- API 测试集合: `docs/api-test-collection.json` (Postman 导出)
- 代码提交: `feat: 后端 API 全部接口实现`

---

## 阶段 4: 管理后台 Web

### 4.1 目标

实现管理后台的完整功能，管理员可通过浏览器进行所有管理操作。

### 4.2 任务清单

#### 4.2.1 基础框架

- [ ] 登录页面
- [ ] 整体布局 (Header + Sider + Content)
- [ ] 侧边菜单导航
- [ ] 路由守卫 (未登录跳转)
- [ ] Token 管理 (存储、过期处理)
- [ ] 全局 Loading 状态
- [ ] 全局错误提示

#### 4.2.2 仪表盘页面

- [ ] 统计卡片 (用户数、订单数、收入等)
- [ ] 课程状态分布图表
- [ ] 最近订单列表
- [ ] 快捷操作入口

#### 4.2.3 小区管理

- [ ] 小区列表页 (表格、搜索、分页)
- [ ] 新增小区表单
- [ ] 编辑小区表单
- [ ] 删除确认

#### 4.2.4 教练管理

- [ ] 教练列表页
- [ ] 新增/编辑教练表单
- [ ] 头像上传

#### 4.2.5 课程管理

- [ ] 课程列表页 (状态筛选)
- [ ] 新增课程表单 (选择小区、教练)
- [ ] 编辑课程表单
- [ ] 课程状态管理
- [ ] 查看报名学员

#### 4.2.6 订单管理

- [ ] 订单列表页 (状态筛选、时间筛选)
- [ ] 订单详情页
- [ ] 退款处理

#### 4.2.7 用户管理

- [ ] 用户列表页
- [ ] 用户详情页 (关联学员、订单)
- [ ] 用户状态管理

#### 4.2.8 会员管理

- [ ] 权益卡列表
- [ ] 新增/编辑权益卡
- [ ] 会员购买记录

#### 4.2.9 系统设置

- [ ] 轮播图管理
- [ ] 轮播图排序
- [ ] 图片上传

### 4.3 页面列表

| 页面 | 路由 | 说明 |
|------|------|------|
| 登录 | `/login` | 管理员登录 |
| 仪表盘 | `/dashboard` | 数据概览 |
| 小区列表 | `/community/list` | 小区管理 |
| 小区表单 | `/community/form/:id?` | 新增/编辑 |
| 教练列表 | `/teacher/list` | 教练管理 |
| 教练表单 | `/teacher/form/:id?` | 新增/编辑 |
| 课程列表 | `/course/list` | 课程管理 |
| 课程表单 | `/course/form/:id?` | 新增/编辑 |
| 课程学员 | `/course/:id/students` | 报名学员 |
| 订单列表 | `/order/list` | 订单管理 |
| 订单详情 | `/order/detail/:id` | 订单详情 |
| 用户列表 | `/user/list` | 用户管理 |
| 用户详情 | `/user/detail/:id` | 用户详情 |
| 权益卡 | `/member/cards` | 权益卡管理 |
| 会员记录 | `/member/records` | 购买记录 |
| 轮播图 | `/system/banners` | 轮播图管理 |

### 4.4 验收标准

| 检查项 | 验收条件 |
|--------|----------|
| 登录 | 账号密码登录成功，跳转仪表盘 |
| 权限控制 | 未登录访问任意页面跳转登录页 |
| 仪表盘 | 统计数据正确显示 |
| CRUD 功能 | 小区、教练、课程增删改查正常 |
| 订单管理 | 订单列表、详情、退款功能可用 |
| 图片上传 | 图片可上传并预览 |
| 表单校验 | 必填项校验、格式校验正常 |

### 4.5 测试内容

| 测试项 | 测试方法 | 预期结果 |
|--------|----------|----------|
| 登录功能 | 输入正确/错误账号密码 | 正确登录成功，错误提示错误 |
| 菜单导航 | 点击侧边菜单 | 正确跳转对应页面 |
| 数据列表 | 访问列表页 | 数据正确加载，分页正常 |
| 搜索筛选 | 输入搜索条件 | 结果正确筛选 |
| 新增数据 | 填写表单提交 | 数据创建成功，列表更新 |
| 编辑数据 | 修改数据提交 | 数据更新成功 |
| 删除数据 | 点击删除确认 | 数据删除成功 |
| 图片上传 | 选择图片上传 | 图片上传成功并显示 |

### 4.6 阶段产出

- 完成文档: `docs/phase-04-summary.md`
- 代码提交: `feat: 管理后台 Web 实现`

---

## 阶段 5: 微信小程序

### 5.1 目标

实现微信小程序用户端的完整功能，用户可通过小程序完成课程浏览、报名、支付全流程。

### 5.2 任务清单

#### 5.2.1 启动流程

- [ ] 隐私协议弹窗
- [ ] 地理位置授权
- [ ] 启动页处理

#### 5.2.2 首页

- [ ] 轮播图组件
- [ ] 定位显示区域
- [ ] 定位切换入口
- [ ] 课程筛选标签 (全部/进行中/已结束)
- [ ] 课程列表组件
- [ ] 课程卡片组件
- [ ] 下拉刷新
- [ ] 上拉加载更多

#### 5.2.3 地图与小区

- [ ] 地图页面 (内置 map 组件)
- [ ] 当前位置显示
- [ ] 小区列表页面
- [ ] 小区搜索
- [ ] 小区选择

#### 5.2.4 课程详情

- [ ] 课程头部信息
- [ ] 教练信息
- [ ] 时间地点信息
- [ ] 价格信息 (普通价/会员价)
- [ ] 报名信息 (已报人数/剩余名额)
- [ ] 拼班说明
- [ ] 底部操作栏 (分享/客服/加入拼班)

#### 5.2.5 登录流程

- [ ] 登录页面
- [ ] 微信快捷登录
- [ ] 手机号授权绑定
- [ ] 用户信息授权

#### 5.2.6 学员管理

- [ ] 学员列表页
- [ ] 新增学员页
- [ ] 学员表单 (证件类型、姓名、证件号、生日、性别)
- [ ] 照片上传
- [ ] 表单校验

#### 5.2.7 报名支付

- [ ] 加入拼班页面
- [ ] 学员选择页面
- [ ] 费用计算展示
- [ ] 协议确认勾选
- [ ] 支付页面
- [ ] 支付结果处理

#### 5.2.8 拼班记录

- [ ] 订单列表页
- [ ] 状态标签筛选
- [ ] 订单卡片组件
- [ ] 订单详情入口

#### 5.2.9 权益卡

- [ ] 权益卡展示页
- [ ] 权益说明
- [ ] 购买入口
- [ ] 会员状态显示

#### 5.2.10 个人中心

- [ ] 未登录状态
- [ ] 已登录状态
- [ ] 用户信息展示
- [ ] 资产展示 (健康豆、优惠券)
- [ ] 功能菜单列表
- [ ] 我的学员入口
- [ ] 关于我们页面

#### 5.2.11 TabBar 导航

- [ ] 首页 Tab
- [ ] 权益卡 Tab
- [ ] 拼班 Tab
- [ ] 我的 Tab

### 5.3 页面列表

| 页面 | 路径 | 说明 |
|------|------|------|
| 首页 | `/pages/index/index` | 课程列表、轮播图 |
| 地图选择 | `/pages/community/map/index` | 地图选小区 |
| 小区列表 | `/pages/community/list/index` | 小区列表搜索 |
| 课程详情 | `/pages/course/detail/index` | 课程详细信息 |
| 登录 | `/pages/user/login/index` | 登录授权 |
| 学员列表 | `/pages/student/list/index` | 我的学员 |
| 新增学员 | `/pages/student/add/index` | 添加学员 |
| 选择学员 | `/pages/student/select/index` | 报名选学员 |
| 确认订单 | `/pages/order/confirm/index` | 订单确认 |
| 支付 | `/pages/order/pay/index` | 支付页面 |
| 拼班记录 | `/pages/order/list/index` | 订单列表 |
| 权益卡 | `/pages/member/rights/index` | 权益卡页面 |
| 个人中心 | `/pages/user/index/index` | 我的页面 |
| 关于我们 | `/pages/user/about/index` | 关于页面 |

### 5.4 验收标准

| 检查项 | 验收条件 |
|--------|----------|
| 启动流程 | 隐私协议 → 定位授权 → 首页 |
| 首页展示 | 轮播图、课程列表正确显示 |
| 地图功能 | 地图显示、小区选择正常 |
| 课程详情 | 信息完整、可加入拼班 |
| 登录流程 | 微信授权登录成功 |
| 学员管理 | 增删改查功能正常 |
| 报名支付 | 完整流程可走通 (模拟支付) |
| 订单查看 | 拼班记录正确显示 |
| 个人中心 | 登录/未登录状态正确 |

### 5.5 测试内容

#### 核心流程测试

| 测试流程 | 操作步骤 | 预期结果 |
|----------|----------|----------|
| 首次启动 | 打开小程序 | 显示隐私协议弹窗 |
| 定位授权 | 同意隐私后 | 显示定位授权弹窗 |
| 课程浏览 | 进入首页 | 课程列表正确加载 |
| 切换小区 | 点击定位区域 | 进入地图/小区列表 |
| 选择小区 | 选择一个小区 | 返回首页，课程更新 |
| 课程详情 | 点击课程卡片 | 进入详情页 |
| 登录 | 点击加入拼班 | 未登录跳转登录页 |
| 微信登录 | 点击快捷登录 | 完成登录返回 |
| 添加学员 | 填写学员信息 | 学员添加成功 |
| 报名课程 | 选学员→确认→支付 | 订单创建成功 |
| 查看订单 | 进入拼班记录 | 显示刚创建的订单 |

#### 界面适配测试

- [ ] iPhone SE (小屏)
- [ ] iPhone 12/13 (标准屏)
- [ ] iPhone 14 Pro Max (大屏)
- [ ] Android 主流机型

### 5.6 阶段产出

- 完成文档: `docs/phase-05-summary.md`
- 代码提交: `feat: 微信小程序实现`
- 最终产出: MVP 版本可交付

---

## 附录

### A. 测试文档模板

每个阶段完成后，需在 `docs/` 目录下创建阶段总结文档，格式参考 `docs/phase-template.md`。

文档命名规范: `phase-XX-summary.md`

### B. 阶段测试文档要求

每个阶段文档必须包含:

1. **完成内容清单**: 列出所有已完成的功能点
2. **详细测试步骤**: 每个功能的测试方法和预期结果
3. **测试结果汇总**: 通过/失败统计
4. **遗留问题**: 未解决的问题和计划
5. **代码提交记录**: commit 信息

### C. 代码规范

参考项目根目录 `CLAUDE.md` 文件。

### D. 相关文档

- 需求文档: `specs/0001-prd.md`
- 设计文档: `specs/0002-design.md`
- UI 设计: `specs/ui/` 目录

---

*文档结束*
