import{r as a,G as dt,H as Le,J as B,K as Oe,L as ut,M as mt,q as gt,N as Ve,O as qe,P as pt,Q as Je,T as et,U as ft,V as ht,W as ve,X as xt,Y as yt,Z as bt,$ as vt,a0 as St,a1 as wt,a2 as Ge,a3 as Ct,a4 as jt,a5 as $t,s as De,F as p,z as F,t,E as Se,A as se,B as It,D as me,S as kt,a6 as zt,v as _t,a7 as Et}from"./index-vJliTLcA.js";import{a as Pt}from"./communities-DwGTXRYT.js";import{a as Rt}from"./teachers-DYIQ3x04.js";import{g as Te,a as Dt,b as Nt}from"./upload-BK1CmKxZ.js";import{C as Fe,b as Mt}from"./index-CVB0USnY.js";import{I as Ht}from"./ImageUpload-BD2lY4S1.js";import{E as Ue}from"./EmptyState-BSaaD0E3.js";import{S as Ie,R as Pe,I as Tt}from"./aiStyles-DOWFd9No.js";import{u as Ft,p as Ke,S as xe,d as re}from"./Pagination-BDGMd9qO.js";import{R as Bt}from"./PlusOutlined-CYRhG2uJ.js";import{F as At,R as we}from"./Table-CXsedqLq.js";import{u as Lt,a as Ot,b as Wt,M as Yt}from"./index-CuHp8ad1.js";import{T as ge}from"./index-DB8BEbqf.js";import{u as Vt,D as We}from"./index-1PM14-1H.js";import{S as qt}from"./Skeleton-6-sq-quy.js";import{D as Re,L as Be}from"./index-Ccf35oLF.js";import{T as Xe}from"./index-Bt7cSXZv.js";import{R as Gt}from"./EditOutlined-CyLgl2ms.js";import"./progress-CwHhQgc-.js";import"./ClockCircleOutlined-C_N1ti8o.js";const Ze=a.createContext(null),tt=a.createContext({});function Ye(){return Ye=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},Ye.apply(this,arguments)}const Ut=s=>{const{prefixCls:n,className:r,containerRef:o,...c}=s,{panel:m}=a.useContext(tt),i=dt(m,o);return a.createElement("div",Ye({className:B(`${n}-section`,r),role:"dialog",ref:i},Le(s,{aria:!0}),{"aria-modal":"true"},c))};function Kt(s){const{prefixCls:n,direction:r,className:o,style:c,maxSize:m,containerRef:i,currentSize:h,onResize:k,onResizeEnd:C,onResizeStart:f}=s,[g,d]=a.useState(!1),[z,E]=a.useState(0),[P,N]=a.useState(0),j=r==="left"||r==="right",R=Oe(w=>{w.preventDefault(),w.stopPropagation(),d(!0),E(j?w.clientX:w.clientY);let $;if(typeof h=="number")$=h;else if(i?.current){const x=i.current.getBoundingClientRect();$=j?x.width:x.height}N($),f?.($)}),S=Oe(w=>{if(!g)return;let x=(j?w.clientX:w.clientY)-z;(r==="right"||r==="bottom")&&(x=-x);let v=P+x;v<0&&(v=0),m&&v>m&&(v=m),k?.(v)}),b=a.useCallback(()=>{if(g&&(d(!1),i?.current)){const w=i.current.getBoundingClientRect(),$=j?w.width:w.height;C?.($)}},[g,i,C,j]);return a.useEffect(()=>{if(g)return document.addEventListener("mousemove",S),document.addEventListener("mouseup",b),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",b)}},[g,S,b]),{dragElementProps:{className:B(`${n}-dragger`,`${n}-dragger-${r}`,{[`${n}-dragger-dragging`]:g,[`${n}-dragger-horizontal`]:j,[`${n}-dragger-vertical`]:!j},o),style:c,onMouseDown:R},isDragging:g}}function Ae(s){if(typeof s=="string"){const n=Number(s.replace(/px$/i,""));if(parseFloat(s)===n&&ut(!1,"Invalid value type of `width` or `height` which should be number type instead."),!Number.isNaN(n))return n}return s}function Xt(s,n,r,o,c){mt(n&&(o??c!==!1),s),gt.useEffect(()=>{n&&r===!0&&s()?.focus({preventScroll:!0})},[n])}function Ce(){return Ce=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(s[o]=r[o])}return s},Ce.apply(this,arguments)}const Zt=(s,n)=>{const{prefixCls:r,open:o,placement:c,inline:m,push:i,forceRender:h,autoFocus:k,focusTrap:C,classNames:f,rootClassName:g,rootStyle:d,zIndex:z,className:E,id:P,style:N,motion:j,width:R,height:S,size:b,maxSize:I,children:w,mask:$,maskClosable:x,maskMotion:v,maskClassName:Y,maskStyle:y,afterOpenChange:M,onClose:ee,onMouseEnter:te,onMouseOver:V,onMouseLeave:le,onClick:q,onKeyDown:ie,onKeyUp:Q,styles:_,drawerRender:A,resizable:L,defaultSize:u}=s,H=a.useRef(null);a.useImperativeHandle(n,()=>H.current),Xt(()=>H.current,o,k,C,$);const[G,X]=a.useState(!1),O=a.useContext(Ze);let U;typeof i=="boolean"?U=i?{}:{distance:0}:U=i||{};const W=U?.distance??O?.pushDistance??180,pe=a.useMemo(()=>({pushDistance:W,push:()=>{X(!0)},pull:()=>{X(!1)}}),[W]);a.useEffect(()=>{o?O?.push?.():O?.pull?.()},[o]),a.useEffect(()=>()=>{O?.pull?.()},[]);const K=a.createElement(Ve,Ce({key:"mask"},v,{visible:$&&o}),({className:D,style:be},$e)=>a.createElement("div",{className:B(`${r}-mask`,D,f?.mask,Y),style:{...be,...y,..._?.mask},onClick:x&&o?ee:void 0,ref:$e})),ce=typeof j=="function"?j(c):j,[ne,ye]=a.useState(),ae=c==="left"||c==="right",de=a.useMemo(()=>Ae(b??(ae?R:S)??ne??u??(ae?378:void 0)),[b,R,S,u,ae,ne]),ue=a.useMemo(()=>{const D={};if(G&&W)switch(c){case"top":D.transform=`translateY(${W}px)`;break;case"bottom":D.transform=`translateY(${-W}px)`;break;case"left":D.transform=`translateX(${W}px)`;break;default:D.transform=`translateX(${-W}px)`;break}return ae?D.width=Ae(de):D.height=Ae(de),D},[G,W,c,ae,de]),J=a.useRef(null),oe=!!L,fe=typeof L=="object"&&L||{},je=Oe(D=>{ye(D),fe.onResize?.(D)}),{dragElementProps:Ne,isDragging:ze}=Kt({prefixCls:`${r}-resizable`,direction:c,className:f?.dragger,style:_?.dragger,maxSize:I,containerRef:J,currentSize:de,onResize:je,onResizeStart:fe.onResizeStart,onResizeEnd:fe.onResizeEnd}),Me={onMouseEnter:te,onMouseOver:V,onMouseLeave:le,onClick:q,onKeyDown:ie,onKeyUp:Q},He=a.createElement(Ve,Ce({key:"panel"},ce,{visible:o,forceRender:h,onVisibleChanged:M,removeOnLeave:!1,leavedClassName:`${r}-content-wrapper-hidden`}),({className:D,style:be},$e)=>{const Ee=a.createElement(Ut,Ce({id:P,containerRef:$e,prefixCls:r,className:B(E,f?.section),style:{...N,..._?.section}},Le(s,{aria:!0}),Me),w);return a.createElement("div",Ce({ref:J,className:B(`${r}-content-wrapper`,ze&&`${r}-content-wrapper-dragging`,f?.wrapper,!ze&&D),style:{...be,...ue,..._?.wrapper}},Le(s,{data:!0})),oe&&a.createElement("div",Ne),A?A(Ee):Ee)}),_e={...d};return z&&(_e.zIndex=z),a.createElement(Ze.Provider,{value:pe},a.createElement("div",{className:B(r,`${r}-${c}`,g,{[`${r}-open`]:o,[`${r}-inline`]:m}),style:_e,tabIndex:-1,ref:H},K,He))},Qt=a.forwardRef(Zt),Jt=s=>{const{open:n=!1,prefixCls:r="rc-drawer",placement:o="right",autoFocus:c=!0,keyboard:m=!0,width:i,height:h,size:k,maxSize:C,mask:f=!0,maskClosable:g=!0,getContainer:d,forceRender:z,afterOpenChange:E,destroyOnHidden:P,onMouseEnter:N,onMouseOver:j,onMouseLeave:R,onClick:S,onKeyDown:b,onKeyUp:I,onClose:w,resizable:$,defaultSize:x,focusTriggerAfterClose:v,panelRef:Y}=s,[y,M]=a.useState(!1),[ee,te]=a.useState(!1);qe(()=>{te(!0)},[]);const V=ee?n:!1,le=a.useRef(null),q=a.useRef(null);qe(()=>{V&&(q.current=document.activeElement)},[V]);const ie=u=>{M(u),E?.(u),!u&&v!==!1&&q.current&&!le.current?.contains(q.current)&&q.current?.focus({preventScroll:!0})},Q=a.useMemo(()=>({panel:Y}),[Y]);if(!z&&!y&&!V&&P)return null;const A={...s,open:V,prefixCls:r,placement:o,autoFocus:c,keyboard:m,width:i,height:h,size:k,maxSize:C,defaultSize:x,mask:f,maskClosable:g,inline:d===!1,afterOpenChange:ie,ref:le,resizable:$,...{onMouseEnter:N,onMouseOver:j,onMouseLeave:R,onClick:S,onKeyDown:b,onKeyUp:I}},L=({top:u,event:H})=>{u&&m&&(H.stopPropagation(),w?.(H))};return a.createElement(tt.Provider,{value:Q},a.createElement(pt,{open:V||z||y,autoDestroy:!1,getContainer:d,autoLock:f&&(V||y),onEsc:L},a.createElement(Qt,A)))},at=s=>{const{prefixCls:n,ariaId:r,title:o,footer:c,extra:m,closable:i,loading:h,onClose:k,headerStyle:C,bodyStyle:f,footerStyle:g,children:d,classNames:z,styles:E}=s,P=Je("drawer"),{classNames:N,styles:j,closable:R}=P,[S,b]=et([N,z],[j,E],{props:{...s,closable:i??R}}),I=a.useMemo(()=>{const y=i??R;if(y!==!1)return typeof y=="object"&&y?.placement==="end"?"end":"start"},[i,R]),w=a.useCallback(y=>a.createElement("button",{type:"button",onClick:k,className:B(`${n}-close`,{[`${n}-close-${I}`]:I==="end"},S.close),style:b.close},y),[k,n,I,S.close,b.close]),[$,x]=Ft(Ke(s),Ke(P),{closable:!0,closeIconRender:w}),v=()=>!o&&!$?null:a.createElement("div",{style:{...b.header,...C},className:B(`${n}-header`,S.header,{[`${n}-header-close-only`]:$&&!o&&!m})},a.createElement("div",{className:`${n}-header-title`},I==="start"&&x,o&&a.createElement("div",{className:B(`${n}-title`,S.title),style:b.title,id:r},o)),m&&a.createElement("div",{className:B(`${n}-extra`,S.extra),style:b.extra},m),I==="end"&&x),Y=()=>c?a.createElement("div",{className:B(`${n}-footer`,S.footer),style:{...b.footer,...g}},c):null;return a.createElement(a.Fragment,null,v(),a.createElement("div",{className:B(`${n}-body`,S.body),style:{...b.body,...f}},h?a.createElement(qt,{active:!0,title:!1,paragraph:{rows:5},className:`${n}-body-skeleton`}):d),Y())},ea=s=>{const n="100%";return{left:`translateX(-${n})`,right:`translateX(${n})`,top:`translateY(-${n})`,bottom:`translateY(${n})`}[s]},st=(s,n)=>({"&-enter, &-appear":{...s,"&-active":n},"&-leave":{...n,"&-active":s}}),rt=(s,n)=>({"&-enter, &-appear, &-leave":{"&-start":{transition:"none"},"&-active":{transition:`all ${n}`}},...st({opacity:s},{opacity:1})}),ta=(s,n)=>[rt(.7,n),st({transform:ea(s)},{transform:"none"})],aa=s=>{const{componentCls:n,motionDurationSlow:r}=s;return{[n]:{[`${n}-mask-motion`]:rt(0,r),[`${n}-panel-motion`]:["left","right","top","bottom"].reduce((o,c)=>({...o,[`&-${c}`]:ta(c,r)}),{})}}},sa=s=>{const{borderRadiusSM:n,componentCls:r,zIndexPopup:o,colorBgMask:c,colorBgElevated:m,motionDurationSlow:i,motionDurationMid:h,paddingXS:k,padding:C,paddingLG:f,fontSizeLG:g,lineHeightLG:d,lineWidth:z,lineType:E,colorSplit:P,marginXS:N,colorIcon:j,colorIconHover:R,colorBgTextHover:S,colorBgTextActive:b,colorText:I,fontWeightStrong:w,footerPaddingBlock:$,footerPaddingInline:x,draggerSize:v,calc:Y}=s,y=`${r}-content-wrapper`,M=`${r}-resizable-dragger`;return{[r]:{position:"fixed",inset:0,zIndex:o,pointerEvents:"none",color:I,"&-pure":{position:"relative",background:m,display:"flex",flexDirection:"column",pointerEvents:"auto",[`&${r}-left`]:{boxShadow:s.boxShadowDrawerLeft},[`&${r}-right`]:{boxShadow:s.boxShadowDrawerRight},[`&${r}-top`]:{boxShadow:s.boxShadowDrawerUp},[`&${r}-bottom`]:{boxShadow:s.boxShadowDrawerDown}},"&-inline":{position:"absolute"},[`${r}-mask`]:{position:"absolute",inset:0,zIndex:o,background:c,pointerEvents:"auto",[`&${r}-mask-blur`]:{backdropFilter:"blur(4px)"}},[y]:{position:"absolute",zIndex:o,maxWidth:"100vw",transition:`all ${i}`,"&-hidden":{display:"none"}},[`&-left > ${y}`]:{top:0,bottom:0,left:{_skip_check_:!0,value:0},boxShadow:s.boxShadowDrawerLeft},[`&-right > ${y}`]:{top:0,right:{_skip_check_:!0,value:0},bottom:0,boxShadow:s.boxShadowDrawerRight},[`&-top > ${y}`]:{top:0,insetInline:0,boxShadow:s.boxShadowDrawerUp},[`&-bottom > ${y}`]:{bottom:0,insetInline:0,boxShadow:s.boxShadowDrawerDown},[`${r}-section`]:{display:"flex",flexDirection:"column",width:"100%",height:"100%",overflow:"auto",background:m,pointerEvents:"auto"},[`${r}-header`]:{display:"flex",flex:0,alignItems:"center",padding:`${ve(C)} ${ve(f)}`,fontSize:g,lineHeight:d,borderBottom:`${ve(z)} ${E} ${P}`,"&-title":{display:"flex",flex:1,alignItems:"center",minWidth:0,minHeight:0}},[`${r}-extra`]:{flex:"none"},[`${r}-close`]:{display:"inline-flex",width:Y(g).add(k).equal(),height:Y(g).add(k).equal(),borderRadius:n,justifyContent:"center",alignItems:"center",color:j,fontWeight:w,fontSize:g,fontStyle:"normal",lineHeight:1,textAlign:"center",textTransform:"none",textDecoration:"none",background:"transparent",border:0,cursor:"pointer",transition:`all ${h}`,textRendering:"auto",[`&${r}-close-end`]:{marginInlineStart:N},[`&:not(${r}-close-end)`]:{marginInlineEnd:N},"&:hover":{color:R,backgroundColor:S,textDecoration:"none"},"&:active":{backgroundColor:b},...xt(s)},[`${r}-title`]:{flex:1,margin:0,fontWeight:s.fontWeightStrong,fontSize:g,lineHeight:d},[`${r}-body`]:{flex:1,minWidth:0,minHeight:0,padding:f,overflow:"auto",[`${r}-body-skeleton`]:{width:"100%",height:"100%",display:"flex",justifyContent:"center"}},[`${r}-footer`]:{flexShrink:0,padding:`${ve($)} ${ve(x)}`,borderTop:`${ve(z)} ${E} ${P}`},[M]:{position:"absolute",zIndex:1,backgroundColor:"transparent",userSelect:"none",pointerEvents:"auto","&:hover":{backgroundColor:s.colorPrimary,opacity:.2},"&-dragging":{backgroundColor:s.colorPrimary,opacity:.3}},[`${M}-left`]:{top:0,bottom:0,right:{_skip_check_:!0,value:0},width:v,cursor:"col-resize"},[`${M}-right`]:{top:0,bottom:0,left:{_skip_check_:!0,value:0},width:v,cursor:"col-resize"},[`${M}-top`]:{insetInline:0,bottom:0,height:v,cursor:"row-resize"},[`${M}-bottom`]:{insetInline:0,top:0,height:v,cursor:"row-resize"},[`${y}-dragging`]:{userSelect:"none",transition:"none",willChange:"width, height",[`${r}-content`]:{pointerEvents:"none"},[`${r}-section`]:{pointerEvents:"none"}},"&-rtl":{direction:"rtl"}}}},ra=s=>({zIndexPopup:s.zIndexPopupBase,footerPaddingBlock:s.paddingXS,footerPaddingInline:s.padding,draggerSize:4}),nt=ft("Drawer",s=>{const n=ht(s,{});return[sa(n),aa(n)]},ra),na={distance:180},Qe=378,ot=s=>{const{rootClassName:n,size:r,defaultSize:o=Qe,height:c,width:m,mask:i,push:h=na,open:k,afterOpenChange:C,onClose:f,prefixCls:g,getContainer:d,panelRef:z=null,style:E,className:P,resizable:N,"aria-labelledby":j,focusable:R,maskStyle:S,drawerStyle:b,contentWrapperStyle:I,destroyOnClose:w,destroyOnHidden:$,...x}=s,{placement:v}=x,Y=yt(),y=x.title?Y:void 0,{getPopupContainer:M,getPrefixCls:ee,direction:te,className:V,style:le,classNames:q,styles:ie,mask:Q}=Je("drawer"),_=ee("drawer",g),[A,L]=nt(_),u=d===void 0&&M?()=>M(document.body):d,H=a.useMemo(()=>typeof r=="number"?r:r==="large"?736:r==="default"?Qe:typeof r=="string"?/^\d+(\.\d+)?$/.test(r)?Number(r):r:!v||v==="left"||v==="right"?m:c,[r,v,m,c]),G={motionName:Ge(_,"mask-motion"),motionAppear:!0,motionEnter:!0,motionLeave:!0,motionDeadline:500},X=je=>({motionName:Ge(_,`panel-motion-${je}`),motionAppear:!0,motionEnter:!0,motionLeave:!0,motionDeadline:500}),O=Lt(),U=bt(z,O),[W,pe]=vt("Drawer",x.zIndex),[K,ce]=Ot(i,Q,_),ne=Wt(R,u!==!1&&K),{classNames:ye,styles:ae,rootStyle:de}=x,ue={...s,zIndex:W,panelRef:z,mask:K,defaultSize:o,push:h,focusable:ne},[J,oe]=et([q,ye],[ie,ae],{props:ue}),fe=B({"no-mask":!K,[`${_}-rtl`]:te==="rtl"},n,A,L,J.root);return a.createElement(St,{form:!0,space:!0},a.createElement(wt.Provider,{value:pe},a.createElement(Jt,{prefixCls:_,onClose:f,maskMotion:G,motion:X,...x,classNames:{mask:B(J.mask,ce.mask),section:J.section,wrapper:J.wrapper,dragger:J.dragger},styles:{mask:{...oe.mask,...S},section:{...oe.section,...b},wrapper:{...oe.wrapper,...I},dragger:oe.dragger},open:k,mask:K,push:h,size:H,defaultSize:o,style:{...le,...E},rootStyle:{...de,...oe.root},className:B(V,P),rootClassName:fe,getContainer:u,afterOpenChange:C,panelRef:U,zIndex:W,...N?{resizable:N}:{},"aria-labelledby":j??y,destroyOnHidden:$??w,focusTriggerAfterClose:ne.focusTriggerAfterClose,focusTrap:ne.trap},a.createElement(at,{prefixCls:_,size:r,...x,ariaId:y,onClose:f}))))},oa=s=>{const{prefixCls:n,style:r,className:o,placement:c="right",...m}=s,{getPrefixCls:i}=a.useContext(Ct),h=i("drawer",n),[k,C]=nt(h),f=B(h,`${h}-pure`,`${h}-${c}`,k,C,o);return a.createElement("div",{className:f,style:r},a.createElement(at,{prefixCls:h,...m}))};ot._InternalPanelDoNotUseOrYouWillBeFired=oa;const{TimePicker:la,RangePicker:ia}=We,ca=a.forwardRef((s,n)=>a.createElement(ia,{...s,picker:"time",mode:void 0,ref:n})),ke=a.forwardRef((s,n)=>{const{addon:r,renderExtraFooter:o,variant:c,bordered:m,classNames:i,styles:h,popupClassName:k,popupStyle:C,...f}=s,[g]=jt("timePicker",c,m),d=a.useMemo(()=>{if(o)return o;if(r)return r},[r,o]),z={...s,variant:g},[E,P]=Vt("timePicker",i,h,k,C,z);return a.createElement(la,{...f,mode:void 0,ref:n,renderExtraFooter:d,variant:g,classNames:E,styles:P})}),lt=$t(ke,"popupAlign",void 0,"picker");ke._InternalPanelDoNotUseOrYouWillBeFired=lt;ke.RangePicker=ca;ke._InternalPanelDoNotUseOrYouWillBeFired=lt;function da(s){return De.get("/api/v1/admin/courses",{params:s})}function ua(s){return De.post("/api/v1/admin/courses",s)}function ma(s,n){return De.put(`/api/v1/admin/courses/${s}`,n)}function ga(s){return De.get(`/api/v1/admin/courses/${s}/students`)}function Na(){const[s,n]=a.useState(!1),[r,o]=a.useState([]),[c,m]=a.useState(0),[i,h]=a.useState({page:1,page_size:10}),[k,C]=a.useState(!1),[f,g]=a.useState(null),[d]=p.useForm(),[z,E]=a.useState(!1),[P,N]=a.useState([]),[j,R]=a.useState([]),[S,b]=a.useState(!1),[I,w]=a.useState(null),[$,x]=a.useState([]),[v,Y]=a.useState(!1),[y,M]=a.useState("upload"),[ee,te]=a.useState(""),[V,le]=a.useState("2K"),[q,ie]=a.useState(!1),[Q,_]=a.useState(null),[A,L]=a.useState(),[u,H]=a.useState(null),[G,X]=a.useState(),[O,U]=a.useState(),[W,pe]=a.useState("manual"),[K,ce]=a.useState(Ie[0].value),[ne,ye]=a.useState(!1),[ae,de]=a.useState({}),ue=p.useWatch("name",d);a.useEffect(()=>{J()},[i]),a.useEffect(()=>{oe()},[]);const J=async()=>{n(!0);try{const e=await da(i);o(e.items),m(e.total)}catch{F.error("获取课程列表失败")}finally{n(!1)}},oe=async()=>{try{const[e,l]=await Promise.all([Pt(),Rt()]);N(e||[]),R(l||[])}catch(e){console.error("获取选项数据失败:",e),N([]),R([])}},fe=e=>{h({...i,page:1,keyword:e})},je=e=>{h({...i,page:1,status:e})},Ne=e=>{h({...i,page:e.current||1,page_size:e.pageSize||10})},ze=()=>{g(null),d.resetFields(),M("upload"),te(ae.new||""),_(null),L(void 0),H(null),X(void 0),U(void 0),pe("manual"),ce(Ie[0].value),C(!0)},Me=e=>{g(e),M("upload"),_(null),te(ae[e.id]||""),pe("manual"),ce(Ie[0].value);let l=e.schedule;if(e.schedule){const T=e.schedule.match(/^(周[一二三四五六日])\s+(\d{2}:\d{2})-(\d{2}:\d{2})$/);T?(L(T[1]),H([re(T[2],"HH:mm"),re(T[3],"HH:mm")])):(L(void 0),H(null))}else if(e.schedule_day&&e.schedule_start&&e.schedule_end){const T=typeof e.schedule_start=="string"?e.schedule_start.substring(0,5):String(e.schedule_start),Z=typeof e.schedule_end=="string"?e.schedule_end.substring(0,5):String(e.schedule_end);l=`${e.schedule_day} ${T}-${Z}`,L(e.schedule_day),H([re(T,"HH:mm"),re(Z,"HH:mm")])}else L(void 0),H(null);let he=e.age_range;if(e.age_range){const T=e.age_range.match(/^(\d+)-(\d+)/);T?(X(parseInt(T[1])),U(parseInt(T[2]))):(X(void 0),U(void 0))}else e.age_min!==void 0&&e.age_max!==void 0?(he=`${e.age_min}-${e.age_max}岁`,X(e.age_min),U(e.age_max)):(X(void 0),U(void 0));d.setFieldsValue({...e,deadline:re(e.deadline),start_date:re(e.start_date),schedule:l,age_range:he}),C(!0)},He=async()=>{if(!K){F.warning("请先选择一种艺术风格");return}if(!ue?.trim()){F.warning("请先填写课程名称");return}const e=d.getFieldsValue();let l=e.location;if(e.location&&A&&u&&u[0]&&u[1]){const Z=`${u[0].format("HH:mm")}-${u[1].format("HH:mm")}`;l=`${e.location}（${A} ${Z}）`}const he=G&&O?`${G}-${O}岁`:void 0,T=P.find(Z=>Z.id===e.community_id)?.name;ye(!0);try{const Z=await Dt({style:K,context_type:"course",context_data:{name:e.name,age_range:he,community_name:T,location:l||"社区运动场",total_weeks:e.total_weeks,total_lessons:e.total_lessons,min_students:e.min_students,max_students:e.max_students}});te(Z.description);const it=f?.id||"new";de(ct=>({...ct,[it]:Z.description})),F.success("描述生成成功，您可以继续编辑")}catch(Z){Z.response?.data?.detail?.code==="API_KEY_MISSING"?F.error("系统未配置AI描述生成功能，请联系管理员"):Z.response?.data?.detail?.code==="QUOTA_EXCEEDED"?F.error("AI服务配额已用完，请稍后重试或手动输入"):F.error("描述生成失败，请手动输入")}finally{ye(!1)}},_e=async()=>{if(!ee.trim()){F.warning("请输入图片描述");return}ie(!0);try{const e=await Nt({prompt:ee,size:V});_(e.url),d.setFieldsValue({image:e.url}),F.success("图片生成成功")}catch(e){e instanceof Error?F.error(e.message):F.error("生成图片失败")}finally{ie(!1)}},D=()=>{Q&&(d.setFieldsValue({image:Q}),F.success("已应用生成的图片"))},be=async e=>{w(e),b(!0),Y(!0);try{const l=await ga(e.id);x(l)}catch{F.error("获取学员列表失败")}finally{Y(!1)}},$e=async()=>{try{const e=await d.validateFields();let l=e.schedule;A&&u&&u[0]&&u[1]&&(l=`${A} ${u[0].format("HH:mm")}-${u[1].format("HH:mm")}`);let he=e.age_range;G!==void 0&&O!==void 0&&(he=`${G}-${O}岁`);const T={...e,deadline:e.deadline.format("YYYY-MM-DD HH:mm:ss"),start_date:e.start_date.format("YYYY-MM-DD"),schedule:l,age_range:he};E(!0),f?(await ma(f.id,T),F.success("更新成功")):(await ua(T),F.success("创建成功")),C(!1),_(null),J()}catch(e){e instanceof Error&&F.error(e.message)}finally{E(!1)}},Ee=[{title:"课程名称",dataIndex:"name",key:"name",render:(e,l)=>t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[l.image&&t.jsx("img",{src:Te(l.image),alt:e,style:{width:48,height:48,borderRadius:"var(--radius-sm)",marginRight:12,objectFit:"cover"}}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:e}),t.jsx("div",{style:{color:"var(--color-text-secondary)",fontSize:12},children:l.age_range})]})]})},{title:"小区",dataIndex:"community_name",key:"community_name",render:(e,l)=>l.community?.name||l.community_name||"-"},{title:"教练",dataIndex:"teacher_name",key:"teacher_name",render:(e,l)=>l.teacher?.name||l.teacher_name||"-"},{title:"价格",key:"price",render:(e,l)=>t.jsxs("div",{children:[t.jsxs("div",{style:{color:"var(--color-text-secondary)",fontSize:12,textDecoration:"line-through"},children:["原价: ¥",l.price]}),t.jsxs("div",{style:{color:"var(--color-primary)",fontWeight:500},children:["会员价: ¥",l.member_price]})]})},{title:"报名人数",key:"students",render:(e,l)=>t.jsxs("span",{children:[l.enrolled_count??l.current_students??0,"/",l.max_students]})},{title:"状态",dataIndex:"status",key:"status",render:e=>!e||!Fe[e]?t.jsx(Xe,{color:"default",children:"未知状态"}):t.jsx(Xe,{color:Mt[e],children:Fe[e]})},{title:"报名截止",dataIndex:"deadline",key:"deadline",render:e=>re(e).format("MM-DD HH:mm")},{title:"操作",key:"action",width:200,render:(e,l)=>t.jsxs(Se,{children:[t.jsx(me,{type:"link",size:"small",icon:t.jsx(Gt,{}),onClick:()=>Me(l),children:"编辑"}),t.jsx(me,{type:"link",size:"small",icon:t.jsx(Et,{}),onClick:()=>be(l),children:"学员"})]})}];return t.jsxs("div",{className:"fade-in",children:[t.jsx("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundImage:"linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.7) 100%), url(/images/course-learning.png)",backgroundSize:"cover, cover",backgroundPosition:"center, center",borderRadius:"var(--radius-lg)",padding:"24px 32px"},children:t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"var(--font-size-2xl)",fontWeight:600,color:"var(--color-text-primary)",marginBottom:4},children:"课程管理"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"管理拼班课程信息"})]})}),t.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:16},children:[t.jsxs(Se,{children:[t.jsx(se.Search,{placeholder:"搜索课程名称",allowClear:!0,onSearch:fe,style:{width:250},prefix:t.jsx(It,{style:{color:"var(--color-text-tertiary)"}})}),t.jsx(xe,{placeholder:"课程状态",allowClear:!0,style:{width:120},onChange:je,options:Object.entries(Fe).map(([e,l])=>({value:e,label:l}))})]}),t.jsx(me,{type:"primary",icon:t.jsx(Bt,{}),onClick:ze,children:"新增课程"})]}),t.jsx(At,{columns:Ee,dataSource:r,rowKey:"id",loading:s,locale:{emptyText:t.jsx(Ue,{description:"暂无课程数据",imageSize:120})},pagination:{current:i.page,pageSize:i.page_size,total:c,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:Ne}),t.jsx(Yt,{title:f?"编辑课程":"新增课程",open:k,onCancel:()=>{C(!1),_(null)},onOk:$e,confirmLoading:z,width:800,destroyOnClose:!0,children:t.jsxs(p,{form:d,layout:"vertical",style:{marginTop:24},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(p.Item,{name:"name",label:"课程名称",rules:[{required:!0,message:"请输入课程名称"}],children:t.jsx(se,{placeholder:"如: 体能+跳绳"})}),t.jsxs(p.Item,{label:"适合年龄",required:!0,children:[t.jsxs(se.Group,{compact:!0,children:[t.jsx(ge,{value:G,onChange:e=>{X(e||void 0),e!=null&&O!==void 0&&d.setFieldsValue({age_range:`${e}-${O}岁`})},placeholder:"最小",min:1,max:18,style:{width:"40%"}}),t.jsx(se,{placeholder:"至",disabled:!0,style:{width:"20%",borderLeft:0,borderRight:0,pointerEvents:"none",textAlign:"center"}}),t.jsx(ge,{value:O,onChange:e=>{U(e||void 0),G!==void 0&&e!==null&&e!==void 0&&d.setFieldsValue({age_range:`${G}-${e}岁`})},placeholder:"最大",min:1,max:18,style:{width:"40%"}})]}),t.jsx(p.Item,{name:"age_range",noStyle:!0,rules:[{required:!0,message:"请选择适合年龄"}],children:t.jsx(se,{type:"hidden"})}),t.jsx("div",{style:{marginTop:8},children:t.jsx(Se,{wrap:!0,size:[8,8],children:[{label:"3-6岁",min:3,max:6},{label:"7-9岁",min:7,max:9},{label:"10-12岁",min:10,max:12},{label:"7-12岁",min:7,max:12},{label:"13-15岁",min:13,max:15}].map(e=>t.jsx(me,{size:"small",type:G===e.min&&O===e.max?"primary":"default",onClick:()=>{X(e.min),U(e.max),d.setFieldsValue({age_range:e.label})},children:e.label},e.label))})})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(p.Item,{name:"community_id",label:"所属小区",rules:[{required:!0,message:"请选择小区"}],children:t.jsx(xe,{placeholder:"请选择小区",options:(P||[]).map(e=>({value:e.id,label:e.name}))})}),t.jsx(p.Item,{name:"teacher_id",label:"授课教练",rules:[{required:!0,message:"请选择教练"}],children:t.jsx(xe,{placeholder:"请选择教练",options:(j||[]).map(e=>({value:e.id,label:e.name}))})})]}),t.jsx(p.Item,{name:"location",label:"上课地点",rules:[{required:!0,message:"请输入上课地点"}],children:t.jsx(se,{placeholder:"请输入详细上课地点"})}),t.jsxs(p.Item,{label:"上课时间",required:!0,children:[t.jsxs(Se.Compact,{style:{width:"100%"},children:[t.jsx(xe,{value:A,onChange:e=>{L(e),e&&u&&u[0]&&u[1]&&d.setFieldsValue({schedule:`${e} ${u[0].format("HH:mm")}-${u[1].format("HH:mm")}`})},placeholder:"选择星期",style:{width:"30%"},options:[{value:"周一",label:"周一"},{value:"周二",label:"周二"},{value:"周三",label:"周三"},{value:"周四",label:"周四"},{value:"周五",label:"周五"},{value:"周六",label:"周六"},{value:"周日",label:"周日"}]}),t.jsx(ke.RangePicker,{value:u,onChange:e=>{H(e),A&&e&&e[0]&&e[1]&&d.setFieldsValue({schedule:`${A} ${e[0].format("HH:mm")}-${e[1].format("HH:mm")}`})},format:"HH:mm",placeholder:["开始时间","结束时间"],style:{width:"70%"}})]}),t.jsx(p.Item,{name:"schedule",noStyle:!0,rules:[{required:!0,message:"请选择上课时间"}],children:t.jsx(se,{type:"hidden"})}),t.jsx("div",{style:{marginTop:8},children:t.jsx(Se,{wrap:!0,size:[8,8],children:[{label:"周六上午",weekday:"周六",start:"08:00",end:"09:00"},{label:"周六下午",weekday:"周六",start:"14:00",end:"15:00"},{label:"周日上午",weekday:"周日",start:"08:00",end:"09:00"},{label:"周日下午",weekday:"周日",start:"14:00",end:"15:00"}].map(e=>t.jsx(me,{size:"small",type:A===e.weekday&&u?.[0]?.format("HH:mm")===e.start&&u?.[1]?.format("HH:mm")===e.end?"primary":"default",onClick:()=>{L(e.weekday),H([re(e.start,"HH:mm"),re(e.end,"HH:mm")]),d.setFieldsValue({schedule:`${e.weekday} ${e.start}-${e.end}`})},children:e.label},e.label))})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:16},children:[t.jsx(p.Item,{name:"total_weeks",label:"总周数",rules:[{required:!0,message:"请输入"}],children:t.jsx(ge,{min:1,style:{width:"100%"}})}),t.jsx(p.Item,{name:"total_lessons",label:"总课时",rules:[{required:!0,message:"请输入"}],children:t.jsx(ge,{min:1,style:{width:"100%"}})}),t.jsx(p.Item,{name:"min_students",label:"最低成班人数",rules:[{required:!0,message:"请输入"}],children:t.jsx(ge,{min:1,style:{width:"100%"}})}),t.jsx(p.Item,{name:"max_students",label:"最大班级人数",rules:[{required:!0,message:"请输入"}],children:t.jsx(ge,{min:1,style:{width:"100%"}})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(p.Item,{name:"price",label:"课程单价",rules:[{required:!0,message:"请输入价格"}],children:t.jsx(ge,{min:0,prefix:"¥",style:{width:"100%"}})}),t.jsx(p.Item,{name:"member_price",label:"会员价",rules:[{required:!0,message:"请输入会员价"}],children:t.jsx(ge,{min:0,prefix:"¥",style:{width:"100%"}})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(p.Item,{name:"deadline",label:"报名截止时间",rules:[{required:!0,message:"请选择"}],children:t.jsx(We,{showTime:!0,style:{width:"100%"}})}),t.jsx(p.Item,{name:"start_date",label:"开课日期",rules:[{required:!0,message:"请选择"}],children:t.jsx(We,{style:{width:"100%"}})})]}),t.jsx(p.Item,{label:"图片来源",children:t.jsxs(we.Group,{value:y,onChange:e=>M(e.target.value),style:{marginBottom:16},children:[t.jsx(we.Button,{value:"upload",children:"上传图片"}),t.jsxs(we.Button,{value:"ai",children:[t.jsx(Pe,{})," AI 生成"]})]})}),y==="upload"?t.jsx(p.Item,{name:"image",label:"课程图片",children:t.jsx(Ht,{})}):t.jsxs("div",{style:{background:"var(--color-bg-secondary)",padding:16,borderRadius:"var(--radius-md)",marginBottom:24},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[t.jsx(p.Item,{label:"描述生成方式",style:{marginBottom:0},children:t.jsxs(we.Group,{value:W,onChange:e=>{pe(e.target.value),e.target.value==="auto"&&!K&&ce(Ie[0].value)},children:[t.jsx(we.Button,{value:"manual",children:"手动输入"}),t.jsxs(we.Button,{value:"auto",children:[t.jsx(Pe,{})," 智能生成"]})]})}),W==="auto"&&t.jsx(p.Item,{label:"艺术风格",style:{marginBottom:0},children:t.jsx(xe,{value:K,onChange:ce,placeholder:"请选择艺术风格",style:{width:"100%"},optionLabelProp:"label",children:Ie.map(e=>t.jsx(xe.Option,{value:e.value,label:e.label,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:e.label}),t.jsx("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:e.description})]})},e.value))})})]}),W==="auto"&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[t.jsx(me,{type:"primary",icon:t.jsx(Pe,{}),onClick:He,loading:ne,disabled:!K||!ue?.trim(),children:ne?"生成中...":"生成描述"}),!ue?.trim()&&t.jsx("span",{style:{fontSize:12,color:"#faad14"},children:"请先填写课程名称"}),ue?.trim()&&!K&&t.jsx("span",{style:{fontSize:12,color:"#faad14"},children:"请选择艺术风格"})]}),t.jsx(p.Item,{label:"图片描述",required:!0,style:{marginBottom:16},children:t.jsx(se.TextArea,{value:ee,onChange:e=>te(e.target.value),placeholder:"请输入图片描述，例如：一群孩子在运动场上进行体能训练，阳光明媚，充满活力",rows:3,maxLength:300,showCount:!0})}),t.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:16,marginBottom:16},children:[t.jsx(p.Item,{label:"图片尺寸",style:{marginBottom:0,flex:1},children:t.jsx(xe,{value:V,onChange:le,options:[{value:"2K",label:"2K（高清）"},{value:"1080P",label:"1080P（标清宽屏）"},{value:"720P",label:"720P（普清）"},{value:"480P",label:"480P（快速预览）"}],style:{width:"100%"}})}),t.jsx(me,{type:"primary",icon:t.jsx(Pe,{}),onClick:_e,loading:q,disabled:!ee.trim(),children:q?"生成中...":"生成图片"})]}),(Q||q)&&t.jsxs("div",{style:{marginTop:16,padding:16,background:"var(--color-bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[t.jsx("div",{style:{marginBottom:8,fontWeight:500,color:"var(--color-text-primary)"},children:"生成结果"}),q?t.jsx("div",{style:{height:160,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-sm)"},children:t.jsx(kt,{tip:"AI 正在生成图片，请稍候..."})}):Q?t.jsxs("div",{children:[t.jsx(Tt,{src:Te(Q),width:200,style:{borderRadius:"var(--radius-sm)",marginBottom:12}}),t.jsx("div",{children:t.jsx(me,{type:"primary",size:"small",onClick:D,children:"使用此图片"})})]}):null]}),t.jsx(p.Item,{name:"image",style:{display:"none"},children:t.jsx(se,{})})]}),t.jsx(p.Item,{name:"description",label:"课程描述",children:t.jsx(se.TextArea,{placeholder:"请输入课程描述",rows:3})})]})}),t.jsxs(ot,{title:`${I?.name||""} - 报名学员`,open:S,onClose:()=>b(!1),width:500,children:[t.jsxs(Re,{column:1,style:{marginBottom:24},children:[t.jsxs(Re.Item,{label:"报名人数",children:[I?.enrolled_count??0,"/",I?.max_students]}),t.jsx(Re.Item,{label:"上课时间",children:I?.schedule}),t.jsx(Re.Item,{label:"上课地点",children:I?.location})]}),t.jsx(Be,{loading:v,dataSource:$,locale:{emptyText:t.jsx(Ue,{description:"暂无报名学员",imageSize:100})},renderItem:e=>t.jsx(Be.Item,{children:t.jsx(Be.Item.Meta,{avatar:t.jsx(zt,{src:Te(e.photo),icon:t.jsx(_t,{}),style:{backgroundColor:"var(--color-primary)"}}),title:e.id_name,description:t.jsxs(Se,{children:[t.jsx("span",{children:e.gender==="male"?"男":"女"}),t.jsx("span",{children:re(e.birthday).format("YYYY-MM-DD")})]})})})})]})]})}export{Na as default};
