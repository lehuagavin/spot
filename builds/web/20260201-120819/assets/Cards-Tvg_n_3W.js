import{r as a,F as s,z as n,t,D as g,A as p}from"./index-vJliTLcA.js";import{g as R,u as y,c as D}from"./members-CRQYknad.js";import{M as b}from"./index-CVB0USnY.js";import{E as q}from"./EmptyState-BSaaD0E3.js";import{S as V,d as B}from"./Pagination-BDGMd9qO.js";import{R as L}from"./PlusOutlined-CYRhG2uJ.js";import{F as Y}from"./Table-CXsedqLq.js";import{M as O}from"./index-CuHp8ad1.js";import{T as c}from"./index-DB8BEbqf.js";import{T as W}from"./index-Bt7cSXZv.js";import{S as $}from"./index-DxXaTdAy.js";import{R as H}from"./EditOutlined-CyLgl2ms.js";import"./Skeleton-6-sq-quy.js";function ae(){const[j,f]=a.useState(!1),[S,v]=a.useState([]),[C,w]=a.useState(0),[l,I]=a.useState({page:1,page_size:10}),[k,o]=a.useState(!1),[m,h]=a.useState(null),[d]=s.useForm(),[T,x]=a.useState(!1);a.useEffect(()=>{u()},[l]);const u=async()=>{f(!0);try{const e=await R();v(Array.isArray(e)?e:[]),w(Array.isArray(e)?e.length:0)}catch{n.error("获取权益卡列表失败")}finally{f(!1)}},_=e=>{I({...l,page:e.current||1,page_size:e.pageSize||10})},z=()=>{h(null),d.resetFields(),o(!0)},M=e=>{h(e);const r={...e};r.duration_days=e.duration,Array.isArray(e.benefits)?r.benefits=e.benefits.join(`
`):e.benefits&&typeof e.benefits=="object"&&"items"in e.benefits&&(r.benefits=e.benefits.items.join(`
`)),d.setFieldsValue(r),o(!0)},A=async(e,r)=>{try{await y(e.id,{status:r?1:0}),n.success("状态更新成功"),u()}catch{n.error("状态更新失败")}},E=async()=>{try{const e=await d.validateFields();if(x(!0),e.benefits&&typeof e.benefits=="string"){const r=e.benefits.split(`
`).map(i=>i.trim()).filter(i=>i.length>0);e.benefits=r.length>0?r:void 0}m?(await y(m.id,e),n.success("更新成功")):(await D(e),n.success("创建成功")),o(!1),u()}catch(e){e instanceof Error&&n.error(e.message)}finally{x(!1)}},F=[{title:"权益卡名称",dataIndex:"name",key:"name",render:e=>t.jsx("span",{style:{fontWeight:500},children:e})},{title:"类型",dataIndex:"type",key:"type",render:e=>e?t.jsx(W,{color:"blue",children:b[e]||e}):"-"},{title:"价格",key:"price",render:(e,r)=>t.jsxs("div",{children:[t.jsxs("div",{style:{color:"var(--color-primary)",fontWeight:600},children:["¥",r.price]}),t.jsxs("div",{style:{color:"var(--color-text-secondary)",fontSize:12,textDecoration:"line-through"},children:["¥",r.original_price]})]})},{title:"有效期",dataIndex:"duration",key:"duration",render:e=>`${e} 天`},{title:"排序",dataIndex:"sort_order",key:"sort_order"},{title:"状态",dataIndex:"status",key:"status",render:(e,r)=>t.jsx($,{checked:e===1,onChange:i=>A(r,i),checkedChildren:"启用",unCheckedChildren:"禁用"})},{title:"创建时间",dataIndex:"created_at",key:"created_at",render:e=>B(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"action",width:100,render:(e,r)=>t.jsx(g,{type:"link",size:"small",icon:t.jsx(H,{}),onClick:()=>M(r),children:"编辑"})}];return t.jsxs("div",{className:"fade-in",children:[t.jsx("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundImage:"linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.7) 100%), url(/images/member-vip.png)",backgroundSize:"cover, cover",backgroundPosition:"center, center",borderRadius:"var(--radius-lg)",padding:"24px 32px"},children:t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"var(--font-size-2xl)",fontWeight:600,color:"var(--color-text-primary)",marginBottom:4},children:"权益卡管理"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"管理会员权益卡配置"})]})}),t.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"flex-end"},children:t.jsx(g,{type:"primary",icon:t.jsx(L,{}),onClick:z,children:"新增权益卡"})}),t.jsx(Y,{columns:F,dataSource:S,rowKey:"id",loading:j,locale:{emptyText:t.jsx(q,{description:"暂无权益卡数据",imageSize:120})},pagination:{current:l.page,pageSize:l.page_size,total:C,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:_}),t.jsx(O,{title:m?"编辑权益卡":"新增权益卡",open:k,onCancel:()=>o(!1),onOk:E,confirmLoading:T,width:600,destroyOnClose:!0,children:t.jsxs(s,{form:d,layout:"vertical",style:{marginTop:24},children:[t.jsx(s.Item,{name:"name",label:"权益卡名称",rules:[{required:!0,message:"请输入权益卡名称"}],children:t.jsx(p,{placeholder:"如: 季卡"})}),t.jsx(s.Item,{name:"type",label:"卡类型",rules:[{required:!0,message:"请选择卡类型"}],children:t.jsx(V,{placeholder:"请选择",options:Object.entries(b).map(([e,r])=>({value:e,label:r}))})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(s.Item,{name:"price",label:"售价",rules:[{required:!0,message:"请输入售价"}],children:t.jsx(c,{min:0,prefix:"¥",style:{width:"100%"}})}),t.jsx(s.Item,{name:"original_price",label:"原价",rules:[{required:!0,message:"请输入原价"}],children:t.jsx(c,{min:0,prefix:"¥",style:{width:"100%"}})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsx(s.Item,{name:"duration_days",label:"有效期(天)",rules:[{required:!0,message:"请输入有效期"}],children:t.jsx(c,{min:1,style:{width:"100%"}})}),t.jsx(s.Item,{name:"sort_order",label:"排序",initialValue:0,children:t.jsx(c,{min:0,style:{width:"100%"}})})]}),t.jsx(s.Item,{name:"description",label:"描述",children:t.jsx(p.TextArea,{placeholder:"请输入权益卡描述",rows:2})}),t.jsx(s.Item,{name:"benefits",label:"权益说明",children:t.jsx(p.TextArea,{placeholder:"请输入权益说明，一行一条",rows:3})})]})})]})}export{ae as default};
