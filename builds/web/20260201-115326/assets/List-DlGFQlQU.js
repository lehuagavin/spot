import{u as _,r as o,z as n,t,A as z,B as w,E as b,D as c,a8 as C}from"./index-vJliTLcA.js";import{g as D,R as Y,p as I}from"./orders-BXqxJSED.js";import{O as m,a as T}from"./index-CVB0USnY.js";import{E as R}from"./EmptyState-BSaaD0E3.js";import{S as M,d as $}from"./Pagination-BDGMd9qO.js";import{D as O}from"./index-1PM14-1H.js";import{F as E}from"./Table-CXsedqLq.js";import{T as F}from"./index-Bt7cSXZv.js";import{M as N}from"./index-CuHp8ad1.js";import"./ClockCircleOutlined-C_N1ti8o.js";import"./Skeleton-6-sq-quy.js";const{RangePicker:B}=O;function V(){const i=_(),[p,l]=o.useState(!1),[u,x]=o.useState([]),[g,h]=o.useState(0),[r,s]=o.useState({page:1,page_size:10});o.useEffect(()=>{d()},[r]);const d=async()=>{l(!0);try{const e=await D(r);x(e.items),h(e.total)}catch{n.error("获取订单列表失败")}finally{l(!1)}},y=e=>{s({...r,page:1,keyword:e})},f=e=>{s({...r,page:1,status:e})},j=e=>{e&&Array.isArray(e)&&e.length===2?s({...r,page:1,start_date:e[0]?.format("YYYY-MM-DD"),end_date:e[1]?.format("YYYY-MM-DD")}):s({...r,page:1,start_date:void 0,end_date:void 0})},v=e=>{s({...r,page:e.current||1,page_size:e.pageSize||10})},k=e=>{N.confirm({title:"确认退款",content:`确定要为订单 ${e.order_no} 处理退款吗？退款金额: ¥${Number(e.pay_amount).toFixed(2)}`,okText:"确认退款",cancelText:"取消",okType:"danger",onOk:async()=>{try{await I(e.id,{reason:"管理员操作退款"}),n.success("退款处理成功"),d()}catch{n.error("退款处理失败")}}})},S=[{title:"订单号",dataIndex:"order_no",key:"order_no",render:(e,a)=>t.jsx("a",{onClick:()=>i(`/order/detail/${a.id}`),style:{fontWeight:500},children:e})},{title:"用户",key:"user",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{children:a.user?.nickname||"-"}),t.jsx("div",{style:{color:"var(--color-text-secondary)",fontSize:12},children:a.user?.phone||"-"})]})},{title:"课程",key:"course",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{children:a.course?.name||"-"}),t.jsx("div",{style:{color:"var(--color-text-secondary)",fontSize:12},children:a.course?.community?.name||"-"})]})},{title:"学员数",dataIndex:"student_ids",key:"student_ids",render:e=>`${e?.length||0} 人`},{title:"订单金额",key:"amount",render:(e,a)=>t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:500},children:["¥",Number(a.pay_amount).toFixed(2)]}),Number(a.discount_amount)>0&&t.jsxs("div",{style:{color:"var(--color-text-secondary)",fontSize:12},children:["优惠: ¥",Number(a.discount_amount).toFixed(2)]})]})},{title:"状态",dataIndex:"status",key:"status",render:e=>t.jsx(F,{color:T[e],children:m[e]})},{title:"创建时间",dataIndex:"created_at",key:"created_at",render:e=>$(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"action",width:150,render:(e,a)=>t.jsxs(b,{children:[t.jsx(c,{type:"link",size:"small",icon:t.jsx(C,{}),onClick:()=>i(`/order/detail/${a.id}`),children:"详情"}),["paid","enrolling"].includes(a.status)&&t.jsx(c,{type:"link",size:"small",danger:!0,icon:t.jsx(Y,{}),onClick:()=>k(a),children:"退款"})]})}];return t.jsxs("div",{className:"fade-in",children:[t.jsx("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundImage:"linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.7) 100%), url(/images/order-shopping.png)",backgroundSize:"cover, cover",backgroundPosition:"center, center",borderRadius:"var(--radius-lg)",padding:"24px 32px"},children:t.jsxs("div",{children:[t.jsx("h1",{style:{fontSize:"var(--font-size-2xl)",fontWeight:600,color:"var(--color-text-primary)",marginBottom:4},children:"订单管理"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"管理用户订单信息"})]})}),t.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",flexWrap:"wrap",gap:16},children:[t.jsx(z.Search,{placeholder:"搜索订单号/用户",allowClear:!0,onSearch:y,style:{width:250},prefix:t.jsx(w,{style:{color:"var(--color-text-tertiary)"}})}),t.jsx(M,{placeholder:"订单状态",allowClear:!0,style:{width:120},onChange:f,options:Object.entries(m).map(([e,a])=>({value:e,label:a}))}),t.jsx(B,{onChange:j,placeholder:["开始日期","结束日期"]})]}),t.jsx(E,{columns:S,dataSource:u,rowKey:"id",loading:p,locale:{emptyText:t.jsx(R,{description:"暂无订单数据",imageSize:120})},pagination:{current:r.page,pageSize:r.page_size,total:g,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:v})]})}export{V as default};
