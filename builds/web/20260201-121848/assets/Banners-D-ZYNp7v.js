import{s as k,r,F as n,z as a,t as e,D as d,A as S,S as oe,E as de}from"./index-DvoX4KWS.js";import{g as _,a as ce,b as ue}from"./upload-DvrawW7b.js";import{I as me,R as ge}from"./ImageUpload-MMgr9A6g.js";import{E as pe}from"./EmptyState-CMF6F_bM.js";import{S as p,R as I,I as q}from"./aiStyles-C31G1lXh.js";import{S as w,d as he}from"./Pagination-C9k_HsGX.js";import{R as xe}from"./PlusOutlined-DIcF2SQF.js";import{F as Ae,R as c}from"./Table-ClhJkhx_.js";import{M as ye}from"./index-DQIhW2ij.js";import{T as je}from"./index-BIxBvGOn.js";import{S as fe}from"./index-ClMwpR7V.js";import{R as ve}from"./EditOutlined-wk0OXdBO.js";import{P as be}from"./index-Dqy8LGeE.js";import"./progress-BlanDxPG.js";import"./Skeleton-DJqBIV4h.js";function Se(i){return k.get("/api/v1/admin/banners",{params:i})}function Ie(i){return k.post("/api/v1/admin/banners",i)}function L(i,h){return k.put(`/api/v1/admin/banners/${i}`,h)}function we(i){return k.delete(`/api/v1/admin/banners/${i}`)}function Le(){const[i,h]=r.useState(!1),[U,V]=r.useState([]),[Y,K]=r.useState(0),[u,H]=r.useState({page:1,page_size:10}),[O,x]=r.useState(!1),[A,M]=r.useState(null),[l]=n.useForm(),[J,R]=r.useState(!1),[z,B]=r.useState("upload"),[C,y]=r.useState(""),[P,N]=r.useState("2K"),[j,F]=r.useState(!1),[m,g]=r.useState(null),[D,E]=r.useState("manual"),[o,f]=r.useState(p[0].value),[Q,G]=r.useState(!1),[T,W]=r.useState({});r.useEffect(()=>{v()},[u]);const v=async()=>{h(!0);try{const t=await Se(u);V(t.items),K(t.total)}catch{a.error("获取轮播图列表失败")}finally{h(!1)}},$=t=>{H({...u,page:t.current||1,page_size:t.pageSize||10})},X=()=>{M(null),l.resetFields(),B("upload"),y(T.new||""),g(null),E("manual"),f(p[0].value),x(!0)},Z=t=>{M(t),l.setFieldsValue(t),B("upload"),g(null),y(T[t.id]||""),E("manual"),f(p[0].value),x(!0)},ee=async()=>{if(!o){a.warning("请先选择一种艺术风格");return}const t=l.getFieldValue("title");if(!t||!t.trim()){a.warning("请先填写标题");return}G(!0);try{const s=await ce({style:o,context_type:"banner",context_data:{title:t.trim()}});y(s.description);const b=A?.id||"new";W(ie=>({...ie,[b]:s.description})),a.success("描述生成成功，您可以继续编辑")}catch(s){s.response?.data?.detail?.code==="API_KEY_MISSING"?a.error("系统未配置AI描述生成功能，请联系管理员"):s.response?.data?.detail?.code==="QUOTA_EXCEEDED"?a.error("AI服务配额已用完，请稍后重试或手动输入"):a.error("描述生成失败，请手动输入")}finally{G(!1)}},te=async()=>{if(!C.trim()){a.warning("请输入图片描述");return}F(!0);try{const t=await ue({prompt:C,size:P});g(t.url),l.setFieldsValue({image:t.url}),a.success("图片生成成功")}catch(t){t instanceof Error?a.error(t.message):a.error("生成图片失败")}finally{F(!1)}},ae=()=>{m&&(l.setFieldsValue({image:m}),a.success("已应用生成的图片"))},re=async t=>{try{await we(t),a.success("删除成功"),v()}catch{a.error("删除失败")}},se=async(t,s)=>{try{await L(t.id,{status:s?1:0}),a.success("状态更新成功"),v()}catch{a.error("状态更新失败")}},ne=async()=>{try{const t=await l.validateFields();R(!0),A?(await L(A.id,t),a.success("更新成功")):(await Ie(t),a.success("创建成功")),x(!1),g(null),v()}catch(t){t instanceof Error&&a.error(t.message)}finally{R(!1)}},le=[{title:"图片",dataIndex:"image",key:"image",width:200,render:t=>e.jsx(q,{src:_(t),width:160,height:80,style:{objectFit:"cover",borderRadius:"var(--radius-sm)"},fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Kc"})},{title:"标题",dataIndex:"title",key:"title",render:t=>e.jsx("span",{style:{fontWeight:500},children:t})},{title:"链接类型",dataIndex:"link_type",key:"link_type",render:t=>({none:"无链接",page:"小程序页面",webview:"网页",course:"课程详情"})[t]||t},{title:"链接地址",dataIndex:"link",key:"link",ellipsis:!0,render:t=>t||"-"},{title:"排序",dataIndex:"sort_order",key:"sort_order"},{title:"状态",dataIndex:"status",key:"status",render:(t,s)=>e.jsx(fe,{checked:t===1,onChange:b=>se(s,b),checkedChildren:"显示",unCheckedChildren:"隐藏"})},{title:"创建时间",dataIndex:"created_at",key:"created_at",render:t=>he(t).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"action",width:150,render:(t,s)=>e.jsxs(de,{children:[e.jsx(d,{type:"link",size:"small",icon:e.jsx(ve,{}),onClick:()=>Z(s),children:"编辑"}),e.jsx(be,{title:"确定要删除这个轮播图吗？",onConfirm:()=>re(s.id),okText:"确定",cancelText:"取消",children:e.jsx(d,{type:"link",size:"small",danger:!0,icon:e.jsx(ge,{}),children:"删除"})})]})}];return e.jsxs("div",{className:"fade-in",children:[e.jsx("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between",backgroundImage:"linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.7) 100%), url(/images/banner-manage.png)",backgroundSize:"cover, cover",backgroundPosition:"center, center",borderRadius:"var(--radius-lg)",padding:"24px 32px"},children:e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"var(--font-size-2xl)",fontWeight:600,color:"var(--color-text-primary)",marginBottom:4},children:"轮播图管理"}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"管理首页轮播图配置"})]})}),e.jsx("div",{style:{marginBottom:16,display:"flex",justifyContent:"flex-end"},children:e.jsx(d,{type:"primary",icon:e.jsx(xe,{}),onClick:X,children:"新增轮播图"})}),e.jsx(Ae,{columns:le,dataSource:U,rowKey:"id",loading:i,locale:{emptyText:e.jsx(pe,{description:"暂无轮播图数据",imageSize:120})},pagination:{current:u.page,pageSize:u.page_size,total:Y,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},onChange:$}),e.jsx(ye,{title:A?"编辑轮播图":"新增轮播图",open:O,onCancel:()=>{x(!1),g(null)},onOk:ne,confirmLoading:J,width:600,destroyOnClose:!0,children:e.jsxs(n,{form:l,layout:"vertical",style:{marginTop:24},children:[e.jsx(n.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:e.jsx(S,{placeholder:"请输入轮播图标题"})}),e.jsx(n.Item,{label:"图片来源",required:!0,children:e.jsxs(c.Group,{value:z,onChange:t=>B(t.target.value),style:{marginBottom:16},children:[e.jsx(c.Button,{value:"upload",children:"上传图片"}),e.jsxs(c.Button,{value:"ai",children:[e.jsx(I,{})," AI 生成"]})]})}),z==="upload"?e.jsx(n.Item,{name:"image",label:"图片",rules:[{required:!0,message:"请上传图片"}],children:e.jsx(me,{})}):e.jsxs("div",{style:{background:"var(--color-bg-secondary)",padding:16,borderRadius:"var(--radius-md)",marginBottom:24},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[e.jsx(n.Item,{label:"描述生成方式",style:{marginBottom:0},children:e.jsxs(c.Group,{value:D,onChange:t=>{E(t.target.value),t.target.value==="auto"&&!o&&f(p[0].value)},children:[e.jsx(c.Button,{value:"manual",children:"手动输入"}),e.jsxs(c.Button,{value:"auto",children:[e.jsx(I,{})," 智能生成"]})]})}),D==="auto"&&e.jsx(n.Item,{label:"艺术风格",style:{marginBottom:0},children:e.jsx(w,{value:o,onChange:f,placeholder:"请选择艺术风格",style:{width:"100%"},optionLabelProp:"label",children:p.map(t=>e.jsx(w.Option,{value:t.value,label:t.label,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t.label}),e.jsx("div",{style:{fontSize:12,color:"var(--color-text-secondary)"},children:t.description})]})},t.value))})})]}),D==="auto"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[e.jsx(d,{type:"primary",icon:e.jsx(I,{}),onClick:ee,loading:Q,disabled:!o||!l.getFieldValue("title"),children:Q?"生成中...":"生成描述"}),!l.getFieldValue("title")&&e.jsx("span",{style:{fontSize:12,color:"#faad14"},children:"请先填写标题"}),l.getFieldValue("title")&&!o&&e.jsx("span",{style:{fontSize:12,color:"#faad14"},children:"请选择艺术风格"})]}),e.jsx(n.Item,{label:"图片描述",required:!0,style:{marginBottom:16},children:e.jsx(S.TextArea,{value:C,onChange:t=>y(t.target.value),placeholder:"请输入图片描述，例如：一个温馨的家庭运动场景，父母和孩子在户外草坪上一起做瑜伽",rows:3,maxLength:300,showCount:!0})}),e.jsx(n.Item,{label:"图片尺寸",style:{marginBottom:16},children:e.jsx(w,{value:P,onChange:N,options:[{value:"2K",label:"2K（高清）"},{value:"1080P",label:"1080P（标清宽屏）"},{value:"720P",label:"720P（普清）"},{value:"480P",label:"480P（快速预览）"}],style:{width:"100%"}})}),e.jsx(d,{type:"primary",icon:e.jsx(I,{}),onClick:te,loading:j,style:{marginBottom:16},children:j?"生成中...":"生成图片"}),(m||j)&&e.jsxs("div",{style:{marginTop:16,padding:16,background:"var(--color-bg-primary)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)"},children:[e.jsx("div",{style:{marginBottom:8,fontWeight:500,color:"var(--color-text-primary)"},children:"生成结果"}),j?e.jsx("div",{style:{height:160,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-sm)"},children:e.jsx(oe,{tip:"AI 正在生成图片，请稍候..."})}):m?e.jsxs("div",{children:[e.jsx(q,{src:_(m),width:200,style:{borderRadius:"var(--radius-sm)",marginBottom:12}}),e.jsx("div",{children:e.jsx(d,{type:"primary",size:"small",onClick:ae,children:"使用此图片"})})]}):null]}),e.jsx(n.Item,{name:"image",rules:[{required:!0,message:"请生成图片"}],style:{display:"none"},children:e.jsx(S,{})})]}),e.jsx(n.Item,{name:"link_type",label:"链接类型",initialValue:"none",children:e.jsx(w,{options:[{value:"none",label:"无链接"},{value:"page",label:"小程序页面"},{value:"webview",label:"网页"},{value:"course",label:"课程详情"}]})}),e.jsx(n.Item,{name:"link",label:"链接地址",children:e.jsx(S,{placeholder:"请输入链接地址"})}),e.jsx(n.Item,{name:"sort_order",label:"排序",initialValue:0,children:e.jsx(je,{min:0,style:{width:"100%"},placeholder:"数值越小越靠前"})})]})})]})}export{Le as default};
