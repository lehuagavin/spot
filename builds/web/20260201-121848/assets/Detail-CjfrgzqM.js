import{u as g,aL as y,r as n,z as o,t as e,S as b,D as d,E as I,a6 as v,v as _}from"./index-DvoX4KWS.js";import{a as Y,R,p as D}from"./orders-a8mT14wa.js";import{g as M}from"./upload-DvrawW7b.js";import{O as S,a as C}from"./index-CVB0USnY.js";import{d as a}from"./Pagination-C9k_HsGX.js";import{R as k}from"./ArrowLeftOutlined-CfbWwcam.js";import{C as l}from"./index-Cpj4FwQo.js";import{D as s,L as c}from"./index-h9rIlmCn.js";import{T as h}from"./index-CqbZCbjk.js";import{M as O}from"./index-DQIhW2ij.js";import"./Skeleton-DJqBIV4h.js";import"./PlusOutlined-DIcF2SQF.js";function W(){const m=g(),{id:i}=y(),[j,x]=n.useState(!0),[r,f]=n.useState(null);n.useEffect(()=>{i&&u()},[i]);const u=async()=>{x(!0);try{const t=await Y(i);f(t)}catch{o.error("获取订单详情失败")}finally{x(!1)}},p=()=>{r&&O.confirm({title:"确认退款",content:`确定要为订单 ${r.order_no} 处理退款吗？退款金额: ¥${Number(r.pay_amount).toFixed(2)}`,okText:"确认退款",cancelText:"取消",okType:"danger",onOk:async()=>{try{await D(r.id,{reason:"管理员操作退款"}),o.success("退款处理成功"),u()}catch{o.error("退款处理失败")}}})};return j?e.jsx("div",{style:{textAlign:"center",padding:100},children:e.jsx(b,{size:"large"})}):r?e.jsxs("div",{className:"fade-in",children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(d,{icon:e.jsx(k,{}),onClick:()=>m("/order/list"),style:{marginRight:16},children:"返回"}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"var(--font-size-2xl)",fontWeight:600,marginBottom:4},children:"订单详情"}),e.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["订单号: ",r.order_no]})]})]}),["paid","enrolling"].includes(r.status)&&e.jsx(d,{danger:!0,icon:e.jsx(R,{}),onClick:p,children:"处理退款"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[e.jsx(l,{title:"订单信息",style:{borderRadius:"var(--radius-lg)"},children:e.jsxs(s,{column:1,children:[e.jsx(s.Item,{label:"订单号",children:r.order_no}),e.jsx(s.Item,{label:"订单状态",children:e.jsx(h,{color:C[r.status],children:S[r.status]})}),e.jsxs(s.Item,{label:"订单金额",children:["¥",Number(r.total_amount).toFixed(2)]}),e.jsxs(s.Item,{label:"优惠金额",children:["¥",Number(r.discount_amount).toFixed(2)]}),e.jsx(s.Item,{label:"实付金额",children:e.jsxs("span",{style:{color:"var(--color-primary)",fontWeight:600,fontSize:18},children:["¥",Number(r.pay_amount).toFixed(2)]})}),e.jsx(s.Item,{label:"创建时间",children:a(r.created_at).format("YYYY-MM-DD HH:mm:ss")}),r.pay_time&&e.jsx(s.Item,{label:"支付时间",children:a(r.pay_time).format("YYYY-MM-DD HH:mm:ss")}),r.refund_time&&e.jsx(s.Item,{label:"退款时间",children:a(r.refund_time).format("YYYY-MM-DD HH:mm:ss")}),r.refund_reason&&e.jsx(s.Item,{label:"退款原因",children:r.refund_reason})]})}),e.jsx(l,{title:"用户信息",style:{borderRadius:"var(--radius-lg)"},children:e.jsxs(s,{column:1,children:[e.jsx(s.Item,{label:"用户昵称",children:r.user?.nickname||"-"}),e.jsx(s.Item,{label:"手机号",children:r.user?.phone||"-"}),e.jsx(s.Item,{label:"是否会员",children:e.jsx(h,{color:r.user?.is_member?"gold":"default",children:r.user?.is_member?"VIP会员":"普通用户"})})]})}),e.jsx(l,{title:"课程信息",style:{borderRadius:"var(--radius-lg)"},children:e.jsxs(s,{column:1,children:[e.jsx(s.Item,{label:"课程名称",children:r.course?.name||"-"}),e.jsx(s.Item,{label:"适合年龄",children:r.course?.age_range||"-"}),e.jsx(s.Item,{label:"所属小区",children:r.course?.community?.name||"-"}),e.jsx(s.Item,{label:"授课教练",children:r.course?.teacher?.name||"-"}),e.jsx(s.Item,{label:"上课时间",children:r.course?.schedule||"-"}),e.jsx(s.Item,{label:"上课地点",children:r.course?.location||"-"})]})}),e.jsx(l,{title:`报名学员 (${r.students?.length||0}人)`,style:{borderRadius:"var(--radius-lg)"},children:e.jsx(c,{dataSource:r.students||[],locale:{emptyText:"暂无学员信息"},renderItem:t=>e.jsx(c.Item,{children:e.jsx(c.Item.Meta,{avatar:e.jsx(v,{src:M(t.photo),icon:e.jsx(_,{}),style:{backgroundColor:"var(--color-primary)"}}),title:t.id_name,description:e.jsxs(I,{children:[e.jsx("span",{children:t.gender==="male"?"男":"女"}),e.jsx("span",{children:a(t.birthday).format("YYYY-MM-DD")})]})})})})})]})]}):e.jsxs("div",{style:{textAlign:"center",padding:100},children:[e.jsx("p",{children:"订单不存在"}),e.jsx(d,{onClick:()=>m("/order/list"),children:"返回列表"})]})}export{W as default};
