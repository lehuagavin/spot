# AI 智能图片描述生成功能使用指南

## 功能概述

本功能通过集成硅基流动的千问模型（Qwen），实现自动生成专业的图片描述，用于 AI 图片生成。

## 配置步骤

### 1. 获取硅基流动 API Key

1. 访问 [硅基流动官网](https://siliconflow.cn/)
2. 注册并登录账号
3. 进入控制台获取 API Key

### 2. 配置环境变量

编辑 `backend/.env` 文件，添加以下配置：

```bash
# 硅基流动 AI 描述生成配置
SILICONFLOW_API_KEY=sk-your-api-key-here
SILICONFLOW_BASE_URL=https://api.siliconflow.cn/v1
SILICONFLOW_MODEL=Qwen/Qwen2.5-7B-Instruct
SILICONFLOW_TIMEOUT=30
```

### 3. 重启后端服务

```bash
cd backend
# 如果使用 uv
uv run uvicorn src.main:app --reload

# 或者使用 python
python -m uvicorn src.main:app --reload
```

## 使用方法

### 在轮播图管理中使用

1. 进入 **系统设置 > 轮播图管理**
2. 点击 **新增轮播图**
3. 填写 **标题**
4. 选择 **图片来源** > **AI 生成**
5. 选择 **描述生成方式** > **智能生成**
6. 选择一种 **艺术风格**：
   - 吉卜力风格：温暖治愈，柔和色彩
   - 未来主义：科技感，几何线条
   - 皮克斯风格：3D 质感，圆润可爱
   - 油画风格：厚重笔触，古典优雅
   - 中国画：水墨意境，淡雅清新
7. 点击 **生成描述** 按钮
8. 等待 AI 生成描述（约 5-10 秒）
9. 描述生成后可以继续编辑
10. 选择图片尺寸，点击 **生成图片**

### 在课程管理中使用

1. 进入 **课程管理 > 课程列表**
2. 点击 **新增课程**
3. 填写课程基本信息：
   - 课程名称（必填）
   - 适合年龄
   - 上课地点
   - 班级规模等
4. 选择 **图片来源** > **AI 生成**
5. 选择 **描述生成方式** > **智能生成**
6. 选择一种 **艺术风格**
7. 点击 **生成描述** 按钮
8. AI 会根据课程信息自动生成描述
9. 可以继续编辑描述
10. 选择图片尺寸，点击 **生成图片**

## 支持的艺术风格

| 风格 | 特点 | 适用场景 |
|------|------|----------|
| 吉卜力 | 温暖治愈，柔和色彩，充满想象力 | 儿童教育、温馨场景 |
| 未来主义 | 科技感，几何线条，鲜明对比 | 现代运动、科技主题 |
| 皮克斯 | 3D质感，圆润可爱，明亮色彩 | 儿童课程、活泼场景 |
| 油画 | 厚重笔触，古典优雅，丰富层次 | 艺术类课程、高端场景 |
| 中国画 | 水墨意境，留白艺术，淡雅清新 | 传统文化、优雅场景 |

## 生成示例

### 轮播图示例

**输入**：
- 标题：春季运动季开启
- 风格：吉卜力

**输出**：
```
春季运动季开启，孩子们在绿意盎然的社区公园里欢快地奔跑、跳跃，教练带领着小朋友们做热身运动，樱花飘落，阳光洒在笑脸上，充满生机与活力。吉卜力工作室风格，水彩画质感，柔和的色彩过渡（樱花粉、草地绿、天空蓝），温暖治愈的氛围，充满童趣和想象力。
```

### 课程示例

**输入**：
- 课程名称：体能+跳绳
- 适合年龄：7-12岁
- 上课地点：碧海金阁小区运动场
- 班级规模：4-10人
- 风格：皮克斯

**输出**：
```
体能+跳绳课程，碧海金阁小区运动场上，7-12岁的孩子们在专业教练指导下进行体能训练，跳绳翻飞、欢声笑语，小朋友们挥洒汗水、突破自我，4-10人小班教学让每个孩子都得到充分关注。皮克斯动画风格，3D渲染质感，圆润的角色设计，明亮温暖的配色（活力橙、运动蓝、阳光黄），活泼可爱的氛围，展现运动的快乐与成长。
```

## 故障排除

### 问题1：提示"系统未配置AI描述生成功能"

**原因**：未配置 `SILICONFLOW_API_KEY`

**解决方法**：
1. 检查 `backend/.env` 文件中是否配置了 `SILICONFLOW_API_KEY`
2. 确认 API Key 是否正确
3. 重启后端服务

### 问题2：提示"AI服务配额已用完"

**原因**：硅基流动 API 配额不足

**解决方法**：
1. 登录硅基流动控制台
2. 检查账户余额和配额
3. 充值或等待配额恢复
4. 或者手动输入描述

### 问题3：生成超时

**原因**：网络问题或 API 响应慢

**解决方法**：
1. 检查网络连接
2. 重试生成
3. 如果持续失败，切换到手动输入模式

### 问题4：生成的描述不符合预期

**解决方法**：
1. 完善课程信息（名称、地点、年龄等）
2. 尝试不同的风格
3. 生成后手动编辑调整
4. 或者直接使用手动输入模式

## 成本估算

- 单次描述生成消耗约 150-200 tokens
- 硅基流动收费标准：约 ¥0.001/次
- 月使用 100 次：约 ¥0.1
- 成本极低，可忽略不计

## 技术支持

如有问题，请查看：
- 硅基流动文档：https://docs.siliconflow.cn/
- 千问模型文档：https://qwen.readthedocs.io/
- 设计文档：`specs/0004-pic-des.design`

## API 端点

### 生成描述

```http
POST /api/v1/ai/generate-description
Content-Type: application/json
Authorization: Bearer <admin-token>

{
  "style": "ghibli",
  "context_type": "banner",
  "context_data": {
    "title": "春季运动季开启"
  }
}
```

### 响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "description": "春季运动季开启...",
    "tokens_used": 156,
    "model": "Qwen/Qwen2.5-7B-Instruct"
  }
}
```

## 更新日志

### v1.0.0 (2026-01-31)
- ✅ 初始版本发布
- ✅ 支持 5 种艺术风格
- ✅ 支持轮播图和课程描述生成
- ✅ 完整的错误处理和降级方案
